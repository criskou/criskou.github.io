<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>自动化测试 | Cris Kou的成长日记</title><meta name="keywords" content="自动化测试"><meta name="author" content="Cris Kou"><meta name="copyright" content="Cris Kou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="自动化测试"><meta name="application-name" content="自动化测试"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="自动化测试"><meta property="og:url" content="http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/index.html"><meta property="og:site_name" content="Cris Kou的成长日记"><meta property="og:description" content="自动化测试这里简单滴记录一哈自动化入门学习笔记，后续陆续补充。 WEB UI自动化Selenium工作原理 自动化程序调用Selenium客户端库， 客户端库发送请求给浏览器驱动， 浏览器驱动再转发这个请求给浏览器， 浏览器将结果返回给浏览器驱动， 浏览器驱动再通过HTTP响应消息返回给Seleni"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="Cris Kou"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="自动化测试这里简单滴记录一哈自动化入门学习笔记，后续陆续补充。 WEB UI自动化Selenium工作原理 自动化程序调用Selenium客户端库， 客户端库发送请求给浏览器驱动， 浏览器驱动再转发这个请求给浏览器， 浏览器将结果返回给浏览器驱动， 浏览器驱动再通过HTTP响应消息返回给Seleni"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"不点回来，我！就！要！闹！","backTitle":"列队欢迎大佬！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Cris Kou","link":"链接: ","source":"来源: Cris Kou的成长日记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Cris Kou的成长日记',
  title: '自动化测试',
  postAI: '',
  pageFillDescription: '自动化测试, WEB UI自动化, Selenium, 工作原理, 安装, 示例, 常见问题, 选择元素, 根据id属性定位元素, 根据class属性选择元素, 根据tag名定位元素, 通过WebElement对象定位元素, 操控元素, CSS表达式, 根据 tag名、id、class 选择元素, 选择子元素和后代元素, 根据属性选择, 联合使用, 组选择, 按次序选择子节点, 兄弟节点选择, XPath选择器, 绝对路径选择, 相对路径选择, 通配符, 根据属性选择, 按次序选择, 范围选择, 组选择、父节点、兄弟节点, frame切换x2F窗口切换, framex2Fiframe, 窗口切换, 选择框, radio, checkbox, select, 其他, 等待方式, 更多动作, 直接执行javascript, 冻结界面, 弹出对话框, 窗口大小, 获取当前窗口标题, 获取当前窗口URL地址, 截屏, 手机模式, 上传文件, API接口自动化, HTTP协议, HTTP请求消息, 请求行 request line, 请求头 request headers, 消息体 message body, HTTP响应消息, 状态行 status line, 响应头 response headers, 消息体 message body, 接口测试概述, Requests库, 实例, requests程序抓包设置代理为Fiddler, 构建请求参数 params, 构建请求消息头 headers, 构建请求消息体 data, XML格式, urlencoded 格式消息体, JSON 格式消息体, 检查响应状态码, 检查响应消息头, 检查响应消息体, Session, requests处理session-Cookie, Session对象使用代理, 接口测试数据准备, 封装API测试类, 配置文件, 自动化测试框架Pytetst, 概述, 安装, 快速上手, 初始化清除, 模块级别, 类级别, 方法级别, 目录级别, 挑选用例执行, 指定一个模块, 指定一个或多个目录, 指定模块里面的函数或者类, 根据名字, 根据标签, 数据驱动, fixture, 例子, fixture本身需要参数, fixture范围, conftest.py, mark, hook, 框架封装, 日志记录, 生成测试报告, 一键执行脚本, 根据业务补充代码, App自动化, Appnium, 原理, 自动化环境搭建, 连接手机, 示例, 查找 应用 Package 和 Activity, 定位元素, 根据id, 根据CLASS NAME, 根据ACCESSIBILITY ID, Xpath, 安卓 UIAutomator, 界面操作和adb命令, 界面操作, adb 命令, 内嵌网页自动化, 修改编译App, 用Chrome查看App内嵌网页, 自动化代码, 注意, 手机浏览器网页自动化, webview、驱动 版本配套自动化测试这里简单滴记录一哈自动化入门学习笔记后续陆续补充自动化工作原理自动化程序调用客户端库客户端库发送请求给浏览器驱动浏览器驱动再转发这个请求给浏览器浏览器将结果返回给浏览器驱动浏览器驱动再通过响应消息返回给客户端客户端将相应数据转化为数据对象返回给自动化代码安装即可安装库还需要安装对应版本的浏览器驱动官方下载地址或者淘宝镜像源下载地址其他浏览器安装相应的驱动示例自动化打开浏览器创建对象指明使用的浏览器驱动如果设置了环境变量括号里可以不写驱动路径调用对象的方法打开指定网址程序运行结束会自动退出浏览器这里加入等待用户输入回车结束防止闪退等待回车键结束程序执行完自动化代码如果想关闭浏览器窗口可以调用对象的方法像这样常见问题关闭日志缺省情况下启动后会在屏幕上输出不少日志信息可以这样关闭浏览器首页显示防病毒重置设置有时打开浏览器会弹出防病毒重置您的设置页面可以这样操作命令行输入运行注册表编辑器在左边的目录树找到删除其下的子项选择元素可以使用浏览器开发者调试工具点击标签在点击左上角图标然后在网页上选择元素就会自动高亮该元素的代码可以看到有等属性他们都可以用来定位元素根据属性定位元素是当前页面唯一的但是有时候元素可能会没有先看怎么根据定位元素返回值是该元素对应的对象名称可以通过该对象对元素进行操作比如输入字符串到元素输入框中点击该元素布拉布拉根据属性选择元素注意是多了个打印每一个元素的文本比如猴子就会打印猴子找到的是所有符合条件的元素放在一个列表中返回如果使用少了一个就只会返回第一个元素如果元素有多个属性值比如燕子可以指定任意一个属性值都可以定位到该元素根据名定位元素就是元素通过对象定位元素对象选择的是整个页面的元素这样选择的是该元素内部的子元素限制选择元素的范围是为元素的内部操控元素点击元素输入框清除已有提示字符串输入新字符串布拉布拉获取元素文本内容这样可以获取展示在界面上的文本内容但是有时候元素的文本内容没有展示在界面上或者没有完全完全展示在界面上这时可以用应对显示不全的情况能够显示属性为的部分获取元素属性获取整个元素对应的获取整个获取该元素内部的获取输入框里的文字表达式当要选择的元素没有属性或者有些我们不想选择的元素也有相同的属性值可以通过定位元素可以参考选择器参考手册根据名选择元素根据属性选择元素的语法是在号前面加上一个井号值根据属性选择元素的语法是在值前面加上一个点值选择子元素和后代元素如果元素是元素的直接子元素选择子元素的语法是这样的元素元素如果元素是元素的后代元素中间是一个或者多个空格隔开元素元素根据属性选择支持通过任何属性来选择元素语法是用一个方括号苏备号前面还可以加上标签名的限制比如表示选择所有标签名为且属性值为的元素还可以不指定属性值比如表示选择所有具有属性名为的元素不管它们的值是什么还可以选择属性值包含某个字符串的元素比如要选择节点里面的属性包含了字符串就可以这样写还可以选择属性值以某个字符串开头的元素比如要选择节点里面的属性以开头就可以这样写同样结尾多个属性的限制沙漠之鹰点击标签就会出现搜索框可以用来验证表达式联合使用的另一个强大之处在选择语法可以联合使用版权选择一个属性值为的节点并且要求其必须是属性值为的节点的子节点不限制类型的简单写法组选择同时选择所有为和为的元素选择所有为里面的和元素不能写成因为逗号是组选择器的分隔符注意组选择结果列表中选中元素排序不是组表达式的次序而是符合这些表达式的元素在文档中的出现的次序按次序选择子节点唐诗李白静夜思杜甫春夜喜雨宋词苏轼赤壁怀古明月几时有江城子乙卯正月二十日夜记梦蝶恋花春景辛弃疾京口北固亭怀古青玉案元夕西江月夜行黄沙道中需求选择唐诗和宋词的第一个作者父元素的第个子节点注意理解这里表示的是该元素是父元素的第二个子元素而不是元素的第二个子元素父元素的倒数第个子节点父元素的第几个某类型的子节点上述需求还可以这样思考选择的是第个类型的子元素选择的是第个类型的子元素父元素的倒数第几个某类型的子节点偶数节点和奇数节点兄弟节点选择上述需求还有一种思考方法就是选择后面紧跟着的兄弟节点相邻兄弟节点选择加号后续所有兄弟节点选择选择器是由国际标准化组织指定的用来在和文档中选择节点的语言选择器参考选择器参考手册有些场景用选择元素很麻烦而却比较方便另外还有其他领域会使用到比如爬虫框架手机框架语法中整个文档根节点用表示如果我们想选择的是根节点下面的节点则可以在搜索框输入绝对路径选择从根节点开始到某个节点每层都依次写下来每层之间用分隔的表达式就是某元素的绝对路径等价于表达式相对路径选择选择网页中某个元素不管它在什么位置如果使用表达式直接写一个就行了表达式应该这样写通配符如果要选择所有节点的所有直接子节点可以使用表达式根据属性选择根据属性来选择元素的语法是属性名属性值根据属性选择选择为的元素可以这样根据属性选择选择所有元素中为的元素可以这样如果一个元素有多个比如北京就应该是不能只写一个属性根据其他属性例如选择具有属性的所有页面元素可以这样属性值包含字符串选择属性值包含字符串的页面元素选择属性值以字符串开头的页面元素如果是结尾呢很遗憾是的语法目前浏览器都不支持按次序选择也可以根据次序选择元素语法比更简洁直接在方括号中使用数字表示次序选择类型第个的子元素第几个子元素选择父元素为的第个子元素不管是什么类型某类型倒数第几个子元素选取类型倒数第个子元素选取类型倒数第个子元素数字是写在括号外面的范围选择选取类型第到个子元素选择属性为的前个子元素选择属性为的后个子元素组选择父节点兄弟节点组选择用竖线隔开多个表达式选所有的元素和所有的元素选择父节点可以选择父节点这是做不到的某个元素的父节点用表示当某个元素没有特征可以直接选择但是它有子节点有特征就可以采用这种方法先选择子节点再指定父节点选择为的节点的父节点兄弟节点选择语法选择为的元素的所有后续兄弟节点等同于选择器选择为的元素的前面第最靠近的兄弟节点目前还做不到注意要在某个元素内部使用选择元素需要在表达式最前面加个点定位元素内部的所有元素切换窗口切换在语法中元素或者元素的内部会包含一个被嵌入的另一份文档在我们使用打开一个网页时我们的操作范围缺省是当前的并不包含被嵌入的文档里面的内容如果我们要操作被嵌入的文档中的元素就必须切换操作范围到被嵌入的文档中括号里可以是元素的属性或者也可以填写所对应的对象完成操作后切回主窗口切换点击链接进入新窗口对象对应的还是老窗口自动化操作也还是在老窗口进行更改方式其中是对象的属性这是一个列表对象里面包括了当前浏览器里面所有的窗口句柄所谓句柄可以理解为网页窗口对应的唯一这样要切换到指定窗口就可以先切换到该窗口得到该窗口的标题栏字符串判断是不是我们要操作的那个窗口如果是那么这时候对象就是对应的该该窗口正好跳出循环要切回来的话先保存原来的句柄变量保存当前窗口的句柄通过前面保存的老窗口的句柄自己切换到老窗口选择框单选框直接点击即可小江老师小江老师小雷老师小雷老师小凯老师小凯老师获取当前选中的元素当前选中的是点选小雷老师小雷老师复选框先把已经选中的选项全部点击一下确保都是未选状态再点击小雷老师小雷老师下拉框是一个新的标签对于选择框专门提供了一个类进行操作导入类创建对象通过对象选中小雷老师类常用方法根据元素的属性来选择从开始根据可见文本选择取消选择其他等待方式在自动化测试脚本的运行过程中操作浏览器的时候对于元素的定位是有一定的超时时间大致在秒如果这个时间内仍然定位不到元素就会抛出异常中止脚本运行可以通过在脚本中设置等待的方式来避免由于网络延迟或浏览器卡顿导致的偶然失败常用的等待方式有三种强制等待隐式等待显示等待强制等待强制等待是一种不建议使用的等待方式它使用方法在代码中强制让程序等待固定的时间而不管网页是否已经加载完成或元素是否已经出现缺点时间浪费强制的等待是由人为设置的固定时间如果设置地过长就会降低测试效率如果过短则无法保证元素或页面加载完成从而导致测试失败依赖于网络环境网络环境的不稳定会导致页面元素加载时间的变化如果使用固定的等待时间就无法适应各种网络环境的差异不灵活强制等待是一种静态等待方式无法根据实际情况动态调整等待时间但是还是有其特定的使用场景页面加载时间长且不稳定但使用强制等待不是最佳实践应该尽量优化页面加载速度和稳定性其他等待方式无法满足需求确保没有其他替代方案时再使用强制等待调试代码隐式等待隐式等待是一种全局性的等待方式在整个测试期间都有效设置隐式等待就会在定位元素时等待一段时间如果元素没有立即出现则继续等待一段时间单位是秒注意隐式等待只对和方法有效使用显示等待时隐式等待会被覆盖掉缺点隐式等待只对和方法有效其他方法不受影响因此可能会导致一些操作失败如果设置的隐式等待时间过长会增加测试执行的总时间从而降低测试效率高并发环境下多个线程使用同一个驱动器对象时隐式等待可能会互相干扰从而导致测试失败使用技巧当需要查找的元素在不同的测试用例中都需要使用时可以将隐式等待放到方法中这样所有的测试用例都可以共享隐式等待的设置显示等待设置一个等待时间和等待条件在规定时间内每隔一段时间查看下条件是否成立不成立会抛出一个超时异常导入模块中的模块的别名用于定义预期条件等待加载直到标题含有注册注册判断元素在中是否存在不保证是否可见等待秒秒之内找到元素并且可见则返回否则报错使用场景等待页面元素加载完成等待异步操作完成等待某些特定条件达成缺点代码复杂容易出现异常如果设置时间太短或者条件不正确都有可能出现异常更多动作鼠标右键点击双击移动鼠标到某个元素鼠标拖拽等这些操作可以通过提供的类来实现鼠标移动到元素上直接执行直接执行里面可以直接用返回我们需要的数据返回的数据转化为中的数据对象进行后续处理是最后一页不是最后一页有时自动化的网页内容很长或者很宽超过一屏显示这时可以调用直接执行代码让该元素出现在窗口可见区正中其中就指代了后面的第一个参数对应的对象对象的方法就是让元素滚动到可见部分指定垂直方向居中指定水平方向居中冻结界面对于效果可以冻结界面然后操作在开发者工具栏里面执行如下代码弹出对话框弹出的对话框有三种类型分别是警告信息确认信息和提示输入只需要点击确认就可以如果要获取里面的内容弹出框有两个选择供用户选择分别是和分别代表确定和取消操作确认还是用这个取消弹出框要用户输入一些信息提交上去窗口大小获取窗口大小改变窗口大小获取当前窗口标题获取当前窗口地址截屏手机模式可以通过参数指定以手机模式打开浏览器上传文件通常网站页面上传文件的功能是通过属性为的元素实现的使用自动化上传文件我们只需要定位到该元素然后通过方法传入要上传的文件路径即可先定位到上传文件的元素再调用对象的方法但是有的网页上传是没有类型的元素的这时候如果是上的自动化可以采用平台专用的方法安装找到点击上传的元素点击等待上传选择文件对话框打开直接发送键盘消息给当前应用程序前提是浏览器必须是当前应用输入文件路径最后的表示回车确定也可能时或者接口自动化协议协议全称是超文本传输协议英文是最初是用来在浏览器和网站服务器服务之间传输超文本网页视频图片等信息的由于简洁易用后来不仅仅是浏览器和服务器之间使用它服务器和服务器之间手机和服务器之间都广泛的采用成了软件系统间通信的首选协议之一有好几个版本包括当前最广泛使用的是版本以前版本除了基于准确来说是基于协议是基于的都是基于协议的所以要进行通讯客户端必须先和服务端创建连接而且双方的信息交互必须是这样一种方式客户端先发送请求给服务端然后服务端发送响应给客户端特别注意协议中服务端不能主动先发送信息给客户端而且在以前的版本服务端返回响应给客户端后连接就会断开下一次双方要进行信息交流必须重复上面的过程重新建立连接客户端发送请求服务返回响应到了版本建立连接后这个连接可以保持一段时间这段时间双方可以多次进行请求和响应无需重新建立连接请求消息请求行以下为请求头请求行以下为请求头消息体请求行包含请求方式协议版本请求方式等请求头关于请求头标准的描述单个请求头的格式是名字值一个请求头占据一行开发者也可以在消息中添加自己定义的请求头消息体等请求添加修改的数据信息通常都是存放在请求消息体中的消息头和消息体之间需要插入一个空行隔开请求消息体通常是某种格式的文本常见的有表单数据响应消息状态行状态行状态码通常表示请求消息没有问题而且服务器也正确处理了重定向响应常见的值是表示客户端的这个请求的地址已经改变了需要客户端重新发起一个请求到另外的一个表示客户端请求有错误常见的值有表示客户端请求不符合接口要求比如格式完全错误表示客户端需要先认证才能发送次请求表示客户端没有权限要求服务器处理这样的请求比如普通用户请求删除别人账号等表示客户端请求的不存在表示服务端在处理请求中发生了未知的错误通常是服务端的代码设计问题或者是服务端子系统出了故障比如数据库服务宕机了响应头作用与请求头类似消息体接口测试概述接口传递数据信息是通过协议进行收发的网站获取网页图片等资源也是通过协议进行收发的两者的不同点在于网页图片这些资源都是静态资源服务端直接读取文件返回给客户端即可无需特别的数据处理而接口请求消息通常都需要服务端程序进行一番处理比如对请求的权限检查从数据库中读出数据进行信息过滤和格式转换最后在响应中返回给客户端内部接口通常是由开发来做测试来做内部的接口测试时重点是做漏洞测试和破坏性测试就好了而外部接口也就是第三方接口测试工程师一定要进行全面测试库官网实例返回对象程序抓包设置代理为还需要安装证书然后执行命令安装一个第三方库这样会让使用本地系统安装的证书构建请求参数构建请求消息头构建请求消息体消息体可能很短只有一个字节比如字符也可能很长有几百兆个字节比如一个视频文件最常见的消息体格式当然是表示网页内容的消息体就是存放信息的地方信息的格式完全取决设计者的需要而接口中消息体基本都是文本文本的格式主要是这种格式良好暂无缺省会使用编码格式消息体这种格式的消息体就是一种键值对的格式存放数据可以放到字典里传递格式消息体良好问题问题使用库的方法构建对象也可以将数据对象直接传递给方法的参数如下检查响应状态码检查响应消息头可以更美观的打印数据直观的展示数据结构检查响应消息体会根据响应消息头比如对编码格式做推测从而包响应消息体中的字节串解码为字符串但是有时没有指定编码格式就需要手动指定要直接获取消息体中的字节串内容可以使用有需要时指定解码方式对于格式的消息体可以通过库的函数把它转化为对象库为我们提供了更方便的方法可以使用对象的方法前面学习过客户端访问服务器时服务器会生成唯一并通过响应头的字段响应给客户端这个唯一就是在生成的同时服务器还生成了这样一个数据结构保存该客户这次登录操作相关信息通常保存在数据库中处理库给我们提供一个类通过这个类无需我们操心库自动帮我们保存服务端返回的数据请求自动在消息头中放入数据创建对象通过对象发送请求还可以这样写没有上面简洁如果这样写后续发送会请求消息头中会丢掉中的数据必须像下面这样写才能让请求包含数据对象使用代理接口测试数据准备如果测试的时候系统前端已经开发完毕在前端删除否则可以通过删除接口删除尽量不要在数据库中直接删除数据封装测试类可以把发送接收消息封装到库中这样可以使我们的测试代码更加简洁比如我们可以创建一个的库调用配置文件我们注意到库文件里面发送请求都是写死了请求的这样做的问题是如果我们测试系统安装在另外的机器上这些代码都得更改地址所以我们应该把被测系统的主机地址写在配置文件中如下所示然后其他代码使用配置文件里面的主机地址像这样登录自动化测试框架概述基于语言的自动化测试框架最知名的有如下款前两款框架主要或者说很大程度上是聚焦在白盒单元测试而主要聚焦在系统测试可以用来做系统测试的自动化它的特点有用编写测试用例简便易用可以用文件系统目录层次对应手工测试用例层次结构灵活的初始化清除机制可以灵活挑选测试用例执行利用第三方插件可以生成不错的报表安装安装即可快速上手编写的测试用例代码文件必须以开头或者以结尾如果把测试用例存放在类中类名必须以为前缀的类用例对应的方法必须以为前缀的方法中用例的检查点直接用的断言进入项目根录执行即可注意直接执行命令不会将当前目录设置为模块搜索路径所以更推荐执行命令打印测试代码中的内容打印详细的执行信息如测试类测试函数的名字目标扫描目录路径产生测试报告初始化清除对自动化测试框架来说初始化清除功能至关重要模块级别模块级别的初始化清除分别在整个模块的测试用例执行前后执行并且只会执行次初始化模块清除模块类级别错误密码类方法装饰器第一个参数固定为而不是初始化类清除类用例类方法装饰器可以通过类名方法名调用该方法第一个参数固定为而不是统计类创建了多少个实例从字符串构造对象类方法可以替代构造方法根据不同的类型参数返回不同的子类对象方法级别类中没有类方法装饰器初始化方法清除方法用例目录级别在需要初始化的目录下面创建一个名为的文件里面内容如下所示这是一个生成器初始化目录甲在这里写清除环境的代码清除目录甲挑选用例执行指定一个模块登录错误登录指定一个或多个目录登录指定模块里面的函数或者类指定一个类登录错误登录错误密码指定类中的方法登录错误登录错误密码根据名字可以是要测试函数名字的一部分并且可以用和来进行筛选错密码错密码根据标签错误密码用例执行命令也可以给整个类加上标签并且可以是中文可以添加多个标签登录测试错误密码用例可以这样定义一个全局变量为整个模块文件设定标签网页测试如果需要定义多个标签可以定义一个列表网页测试登录测试自定义的标签运行时会有告警可以在项目根目录下创建配置文件并且在里面设置标签配置项如下网页测试标记为网页测试数据驱动如果有一批测试用例具有相同的测试步骤只是测试参数数据不同自动化测试时把测试数据从用例代码中分离开来以后增加新的测试用例只需要修改数据这就是数据驱动错误登录请输入用户名请输入密码登录失败用户名或者密码错误登录失败用户名或者密码错误登录失败用户名或者密码错误参考官网数据驱动前面讲初始化清除时主要用的是风格的初始化清除方法里面有更灵活方便的初始化清除方法就是使用跟的依赖注入类似例子定义一个函数执行创建张三账号的代码这是系统创建用户产生的其它信息用代替这里写清除部分的代码执行清除张三账号的代码参数为函数名这样用例使用到的生成器语法所谓生成器正常不加代码是顺序执行的加上后变成类似和分步执行本身需要参数就需要使用装饰器并指定参数定义一个函数这里代码实现了使用创建用户账号功能这是系统创建用户产生的其它信息用例测试行为用例测试行为这里参数是特殊的名字是内置的对象这个对象的属性是一个里面保存了传入的一个个参数范围由小到大有下面这几种级别范围函数级别缺省值会在测试函数结束时执行对应的清除类级别会在类里面的最后一个测试方法结束时执行对应的清除模块文件级别会在模块文件里面的最后一个测试方法结束时执行对应的清除目录级别会在目录里面的最后一个测试方法结束时执行对应的清除整个测试级别会在整个测试的最后一个测试方法结束时执行对应的清除缺省为函数级别参数的作用为是否设置默认使用设置为后就不用在用例方法的参数中写上函数名了会自动调用全局文件将放到此文件中就可以在全局使用注册标记在项目根目录中创建配置文件单元测试端对端打上标记筛选标记可筛选多个模块的用例通过可以改变原有的运行方式例如用组织用例时原本无法识别但通过就可以调用了创建文件组织用例在中添加创建在合适的时机会自动调用中的用例步骤运行脚本即可框架封装日志记录日志管理官方文档修改配置文件生成测试报告结合生成测试报告修改配置文件添加执行命令根据目录中生成的测试数据生成测试报告并保存在目录下一键执行脚本创建文件启动框架根据业务补充代码举例接口自动化测试框架封装通过组织用例百度接口测试通过调用请求接口断言响应接收文件自动化原理自动化程序调用客户端库相应的函数发送指令封装在消息里给再转发这个指令给手机上的自动化代理手机上的自动化代理接收到指令后调用手机平台的自动化库执行点击操作返回点击成功的结果给转发给自动化程序自动化程序了解到本操作成功后继续后面的自动化流程其中自动化代理控制使用的什么库来实现自动化的呢如果测试的是苹果手机用的是苹果的框架版本以后如果测试的是安卓手机用的是安卓的框架以后自动化环境搭建安装库安装是用运行的基于开发出来的组织为了方便大家安装使用制作了一个可执行程序把运行环境和一些工具打包在里面了只需要简单的下载安装就可以了下载地址安装添加环境变量安装添加一个环境变量设置值为包解压目录推荐另外配置环境变量加入所在目录连接手机打开开发者模式开启调试示例被测手机是安卓手机安卓版本如果是鸿蒙系统依次尝试这些版本号设备名安卓手机可以随意填写启动名称启动名称自动化需要输入中文时填执行完程序恢复原来输入法不要重置连接初始化自动化环境设置缺省等待时间如果有青少年保护界面点击我知道了根据定位搜索位置框点击根据定位搜索输入框点击白月黑羽输入回车键确定搜索选择定位所有视频标题打印标题查找应用和如果没有打开进入应用界面执行会显示最近的几个信息例如会打印其中应用的名称就是应用的启动就是如果有文件执行定位元素要自动化手机应用同样需要工具查看界面元素的特征常用的查看工具是包中的和中的在目录目录的目录中根据根据安卓界面元素的属性其实就是根据元素的类型类似里面的一般我们根据属性来选择元素是要选择多个而不是一个根据元素的属性是用来描述该元素的作用的如果要查询的界面元素有属性我们可以通过它来定位选择元素找人可靠性和性能不如自动化因为自动化对的支持是由浏览器实现的而的支持是实现的毕竟浏览器产品的成熟度比要高很多语法都类似但又一点属性值安卓以上这些方法选择元素其实底层都是利用了安卓框架的功能实现的谷歌安卓官网也就是说程序的这些定位请求被转发给手机自动化代理程序就转化为为里面相应的定位函数调用其实我们的自动化程序可以直接告诉手机上的自动化代理程序让它调用的代码实现最为直接的自动化控制主要是通过这个类里面的方法实现元素定位的比如热门通过属性和的属性两个条件来定位元素这样做的好处是里面有些元素选择的方法可以解决前面解决不了的问题方法可以根据元素的文本属性查找元素根据文本包含什么字符串根据文本以什么字符串开头方法可以使用正则表达式选择一些元素如下我的界面操作和命令界面操作点击对象的方法点按和的区别是是针对坐标而不是针对找到的元素但是不同的手机有不同的分辨率所以是更好的使用方式实在没有别的方法定位才使用查看该元素的属性中有一个属性它就是表示元素的左上角右下角坐标的坐标还可以使用直接光标移动看右边的属性提示第一个参数是个列表表示点击的坐标注意最多可以有个元素代表根手指点击个坐标所以是类型第二个参数表示点按屏幕后停留的时间如果点按时间过长就变成了长按操作了输入对象的方法获取界面文本信息对象的属性滑动前面个参数是滑动起点和终点的坐标第个参数是滑动从起点到终点坐标所耗费的时间注意这个滑动时间如果太快可能会有惯性滑动按键输入回车键确定搜索按键的定义可以参考这篇文档长按双击移动的类提供了更多的手机操作方法比如长按双击移动参考源代码中的注释长按查看通知栏一通过滑动实现二通过以下方法通知栏里面的元素自动化的方法和前面介绍的界面元素自动化是一样的收起通知栏收起通知栏可以使用前面介绍的模拟按键发出返回按键的方法命令工具在中的目录下确保路径在环境变量中既然这是个命令就可以使用的或者来自动化调用它比如截屏官网命令介绍常用命令查看连接的设备列出文件和传输文件查看目录上传下载登录执行各种命令等内嵌网页自动化很多移动都是混合应用混合应用主要是指它的一部分是原生界面和代码而另一部分是内嵌网页中的内嵌的展示网页内容的模块我们称之为比如微信打开某个朋友圈或者别人发来的的链接对其自动化则需要修改源代码修改编译要对内嵌网页进行自动化首先要请开发人员修改源代码保证对对象加入的调用编译出一个支持自动化的版本否则无法对中的内容进行自动化操作找到对象添加打开内容开关用查看内嵌网页产生了支持自动化的接下来我们就可以安装到手机上进行内嵌网页的自动化了但是因为网页内容在手机中呈现不能像电脑浏览器那样打开开发者工具查看元素内容那如何来定位选择元素呢这里要分两种情况不依赖环境这种情况的内嵌和部分没有交互直接用浏览器里面的手机模式打开对应的网页即可一般是该公司的手机网址依赖环境这种情况的内嵌和部分有交互它必须在中才能运行可以通过浏览器的远程调试功能需要挂梯子然后操作步骤如下确保我们的应用运行打开浏览器地址栏输入点击即可查看具体参考官网自动化代码手机中里面的网页内容是在一个独立于应用部分的环境里面的而缺省情况下这样的代码选择元素只会在部分的界面寻找元素肯定找不到元素把一个界面环境称之为一个部分的名字为而部分的则为部分是应用的名可以通过属性获取当前所有的用属性获取当前所在的然后使用切换即可切换回来注意现在新版本的对这种类型的自动化需要加上否则可能出现里面选择元素出现的问题手机浏览器网页自动化有的公司开发了手机版网站直接用手机浏览器打开的并不是手机要实现自动化首先必须在手机上安装谷歌浏览器然后我们的自动化程序代码如下所示白月黑羽驱动版本配套对于比较老的手机手机里面的版本也会比较老这是就会出现和新版本的里面的不匹配的问题这时需要下载相应版本的在中进行设置路径参考链接',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-19 08:39:54',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Cris Kou的成长日记</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>1</sup></a><a href="/tags/Python%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Python基础<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.05rem;">学习笔记<sup>1</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">测试工具<sup>4</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">自动化测试<sup>1</sup></a><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 1.05rem;">读书笔记<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>自动化测试</span></a></span></div></div><h1 class="post-title" itemprop="name headline">自动化测试</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-02-16T01:42:27.000Z" title="发表于 2025-02-16 09:42:27">2025-02-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-02-19T00:39:54.170Z" title="更新于 2025-02-19 08:39:54">2025-02-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"><header><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url">自动化测试</a><h1 id="CrawlerTitle" itemprop="name headline">自动化测试</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Cris Kou</span><time itemprop="dateCreated datePublished" datetime="2025-02-16T01:42:27.000Z" title="发表于 2025-02-16 09:42:27">2025-02-16</time><time itemprop="dateCreated datePublished" datetime="2025-02-19T00:39:54.170Z" title="更新于 2025-02-19 08:39:54">2025-02-19</time></header><h1 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h1><p>这里简单滴记录一哈自动化入门学习笔记，后续陆续补充。</p>
<h2 id="WEB-UI自动化"><a href="#WEB-UI自动化" class="headerlink" title="WEB UI自动化"></a>WEB UI自动化</h2><h3 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h3><h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><ul>
<li>自动化程序调用Selenium客户端库，</li>
<li>客户端库发送请求给<strong>浏览器驱动</strong>，</li>
<li>浏览器驱动再转发这个请求给浏览器，</li>
<li>浏览器将结果返回给浏览器驱动，</li>
<li>浏览器驱动再通过HTTP响应消息返回给Selenium客户端，</li>
<li>Selenium客户端将相应数据转化为数据对象返回给自动化代码。</li>
</ul>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><code>pip install selenium</code>即可安装Selenium库。还需要安装对应版本的浏览器驱动。</p>
<p> <a target="_blank" rel="noopener" href="https://googlechromelabs.github.io/chrome-for-testing/">Chrome driver 官方下载地址</a>或者<a target="_blank" rel="noopener" href="https://registry.npmmirror.com/binary.html?path=chrome-for-testing/">Chrome driver 淘宝镜像源下载地址</a>，其他浏览器安装相应的驱动。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>自动化打开chrome浏览器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建WebDriver对象，指明使用的浏览器驱动</span></span><br><span class="line"><span class="comment"># 如果设置了环境变量，括号里可以不写</span></span><br><span class="line">WebDriver = webdriver.Chrome(service = Service(<span class="string">&quot;驱动路径&quot;</span>)) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用WebDriver对象的get方法，打开指定网址</span></span><br><span class="line">WebDriver.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序运行结束会自动退出浏览器，这里加入等待用户输入回车结束，防止“闪退”</span></span><br><span class="line"><span class="built_in">input</span>(<span class="string">&#x27;等待回车键结束程序&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行完自动化代码，如果想关闭浏览器窗口可以调用WebDriver对象的 quit 方法，像这样 wd.quit()</p>
</blockquote>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><ul>
<li>关闭chromedriver日志</li>
</ul>
<p>缺省情况下启动chromedriver后，会在屏幕上输出不少日志信息，可以这样关闭：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_experimental_option(</span><br><span class="line">	<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-logging&#x27;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">wd = webdriver.Chrome(options = options)</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器首页显示防病毒重置设置</li>
</ul>
<p>有时打开浏览器会弹出Windows Defender防病毒重置您的设置页面，可以这样操作：</p>
<blockquote>
<p>命令行输入 <code>regedit</code> ，运行注册表编辑器</p>
<p>在左边的目录树找到 <code>HKEY_CURRENT_USER\Software\Google\Chrome</code></p>
<p>删除其下的 <code>TriggeredReset</code> 子项</p>
</blockquote>
<h4 id="选择元素"><a href="#选择元素" class="headerlink" title="选择元素"></a>选择元素</h4><p>可以使用浏览器开发者调试工具F12，点击Elements标签，在点击左上角图标，然后在网页上选择元素，就会自动高亮该元素的代码。可以看到有<code>id</code>、<code>class</code>等属性，他们都可以用来定位元素。</p>
<h5 id="根据id属性定位元素"><a href="#根据id属性定位元素" class="headerlink" title="根据id属性定位元素"></a>根据id属性定位元素</h5><p>id是当前html页面唯一的，但是有时候元素可能会没有id，先看怎么根据id定位元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line"><span class="meta">... </span>...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回值是该元素对应的WebElement对象</span></span><br><span class="line">element = wd.find_element(By.ID, <span class="string">&#x27;id名称&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过该对象对元素进行操作，比如输入字符串到元素输入框中</span></span><br><span class="line">element.click() <span class="comment"># 点击该元素</span></span><br><span class="line">element.send_keys(<span class="string">&#x27;布拉布拉\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="根据class属性选择元素"><a href="#根据class属性选择元素" class="headerlink" title="根据class属性选择元素"></a>根据class属性选择元素</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意是elements，多了个s</span></span><br><span class="line">elements = wd.find_elements(By.CLASS_NAME, <span class="string">&#x27;animal&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印每一个元素的文本，比如&lt;div class=animal&gt;猴子&lt;/div&gt;就会打印猴子</span></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> elements:</span><br><span class="line">    <span class="built_in">print</span>(element.text)</span><br></pre></td></tr></table></figure>

<p>找到的是所有符合条件的元素，放在一个列表中返回，如果使用find_element（少了一个s），就只会返回第一个元素。</p>
<p>如果元素有多个class属性值，比如<code>&lt;div class=&#39;animal bird&#39;&gt;燕子&lt;/div&gt;</code>，可以指定任意一个class属性值，都可以定位到该元素。</p>
<h5 id="根据tag名定位元素"><a href="#根据tag名定位元素" class="headerlink" title="根据tag名定位元素"></a>根据tag名定位元素</h5><p>tag就是html元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elements = wd.find_elements(By.TAG_NAME, <span class="string">&#x27;div&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="通过WebElement对象定位元素"><a href="#通过WebElement对象定位元素" class="headerlink" title="通过WebElement对象定位元素"></a>通过WebElement对象定位元素</h5><p>webdriver对象选择的是整个web页面的元素，这样选择的是该元素内部的子元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">element = wd.find_element(By.ID,<span class="string">&#x27;container&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制 选择元素的范围是 id 为 container 元素的内部。</span></span><br><span class="line">spans = element.find_elements(By.TAG_NAME, <span class="string">&#x27;span&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="操控元素"><a href="#操控元素" class="headerlink" title="操控元素"></a>操控元素</h5><ul>
<li><p>点击元素</p>
</li>
<li><p>输入框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除已有提示字符串</span></span><br><span class="line">element.clear()</span><br><span class="line"><span class="comment"># 输入新字符串</span></span><br><span class="line">element.send_keys(<span class="string">&#x27;布拉布拉&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取元素文本内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(element.text)</span><br></pre></td></tr></table></figure>

<p>这样可以获取<strong>展示在界面上</strong>的文本内容，但是有时候，元素的文本内容没有展示在界面上，或者没有完全完全展示在界面上。这时可以用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element.get_attribute(<span class="string">&#x27;innerText&#x27;</span>) <span class="comment"># 应对显示不全的情况</span></span><br><span class="line">element.get_attribute(<span class="string">&#x27;textContent&#x27;</span>) <span class="comment"># 能够显示display属性为none的部分</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>获取元素属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.get_attribute(<span class="string">&#x27;class&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取整个元素对应的html</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element.get_attribute(<span class="string">&#x27;outerHTML&#x27;</span>) <span class="comment"># 获取整个html</span></span><br><span class="line">element.get_attribute(<span class="string">&#x27;innerHTML&#x27;</span>) <span class="comment"># 获取该元素内部的html</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取输入框里的文字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.get_attribute(<span class="string">&#x27;value&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="CSS表达式"><a href="#CSS表达式" class="headerlink" title="CSS表达式"></a>CSS表达式</h5><p>当要选择的 元素 没有id、class 属性，或者有些我们不想选择的元素也有相同的 id、class属性值，可以通过CSS Selector定位元素。CSS Selector可以参考：<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/cssref/css_selectors.asp">CSS选择器参考手册</a></p>
<h6 id="根据-tag名、id、class-选择元素"><a href="#根据-tag名、id、class-选择元素" class="headerlink" title="根据 tag名、id、class 选择元素"></a>根据 tag名、id、class 选择元素</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elements = wd.find_elements(By.CSS_SELECTOR, <span class="string">&#x27;div&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>根据id属性 选择元素的语法是在id号前面加上一个井号： <code>#id值</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element = wd.find_element(By.CSS_SELECTOR, <span class="string">&#x27;#searchtext&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>根据class属性 选择元素的语法是在 class 值 前面加上一个点： <code>.class值</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elements = wd.find_elements(By.CSS_SELECTOR, <span class="string">&#x27;.animal&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h6 id="选择子元素和后代元素"><a href="#选择子元素和后代元素" class="headerlink" title="选择子元素和后代元素"></a>选择子元素和后代元素</h6><p>如果 <code>元素2</code> 是 <code>元素1</code> 的 直接子元素， CSS Selector 选择子元素的语法是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">元素1 &gt; 元素2</span><br></pre></td></tr></table></figure>

<p>如果 <code>元素2</code> 是 <code>元素1</code> 的 后代元素，中间是一个或者多个空格隔开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">元素1   元素2</span><br></pre></td></tr></table></figure>

<h6 id="根据属性选择"><a href="#根据属性选择" class="headerlink" title="根据属性选择"></a>根据属性选择</h6><p>支持通过任何属性来选择元素，语法是用一个方括号 <code>[]</code> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &lt;a href=&quot;http://www.miitbeian.gov.cn&quot;&gt;苏ICP备88885574号&lt;/a&gt;</span></span><br><span class="line">element = wd.find_element(By.CSS_SELECTOR, <span class="string">&#x27;[href=&quot;http://www.miitbeian.gov.cn&quot;]&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>前面还可以加上标签名的限制，比如 <code>div[class=&#39;SKnet&#39;]</code> 表示 选择所有 标签名为div，且class属性值为SKnet的元素。</p>
<p>还可以不指定属性值，比如 <code>[href]</code> ， 表示选择 所有 具有 属性名 为href 的元素，不管它们的值是什么。</p>
<p>还可以选择 属性值 <code>包含</code> 某个字符串的元素，比如， 要选择a节点，里面的href属性包含了miitbeian字符串，就可以这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[href*=&quot;miitbeian&quot;]</span><br></pre></td></tr></table></figure>

<p>还可以选择属性值以某个字符串开头的元素，比如， 要选择a节点，里面的href属性以abc开头 ，就可以这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[href^=&quot;abc&quot;]</span><br></pre></td></tr></table></figure>

<p>同样，结尾：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[href$=&quot;abc&quot;]</span><br></pre></td></tr></table></figure>

<p>多个属性的限制：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &lt;div class=&quot;misc&quot; ctype=&quot;gun&quot;&gt;沙漠之鹰&lt;/div&gt;</span></span><br><span class="line">div[<span class="keyword">class</span>=misc][ctype=gun]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>F12点击 Elements 标签， Ctrl+F， 就会出现搜索框，可以用来验证CSS Selector表达式</p>
</blockquote>
<h6 id="联合使用"><a href="#联合使用" class="headerlink" title="联合使用"></a>联合使用</h6><p>CSS selector的另一个强大之处在， 选择语法可以联合使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&lt;div class=&#x27;footer1&#x27;&gt;</span></span><br><span class="line"><span class="comment">#        &lt;span class=&#x27;copyright&#x27;&gt;版权&lt;/span&gt;</span></span><br><span class="line"></span><br><span class="line">div.footer1 &gt; span.copyright <span class="comment"># 选择 一个class属性值为copyright 的span节点， 并且要求其必须是class属性值为footer1的div节点的子节点</span></span><br><span class="line">.footer1 &gt; .copyright <span class="comment"># 不限制类型的简单写法</span></span><br></pre></td></tr></table></figure>

<h6 id="组选择"><a href="#组选择" class="headerlink" title="组选择"></a>组选择</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.plant , .animal <span class="comment"># 同时选择所有class 为 plant 和 class 为 animal 的元素</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择所有 id 为 t1 里面的 span 和 p 元素</span></span><br><span class="line">elements = wd.find_elements(By.CSS_SELECTOR, <span class="string">&#x27;#t1 &gt; span , #t1 &gt; p&#x27;</span>)</span><br><span class="line"><span class="comment"># 不能写成#t1 &gt; span,p因为逗号是组选择器的分隔符</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：组选择结果列表中，选中元素排序， 不是组表达式的次序， 而是符合这些表达式的元素，在HTML文档中的出现的次序。</p>
</blockquote>
<h6 id="按次序选择子节点"><a href="#按次序选择子节点" class="headerlink" title="按次序选择子节点"></a>按次序选择子节点</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;t1&#x27;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h3</span>&gt;</span> 唐诗 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">span</span>&gt;</span>李白<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>静夜思<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">span</span>&gt;</span>杜甫<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>春夜喜雨<span class="tag">&lt;/<span class="name">p</span>&gt;</span>              </span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span>      </span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;t2&#x27;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">h3</span>&gt;</span> 宋词 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">span</span>&gt;</span>苏轼<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>赤壁怀古<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>明月几时有<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>江城子·乙卯正月二十日夜记梦<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>蝶恋花·春景<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">span</span>&gt;</span>辛弃疾<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>京口北固亭怀古<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>青玉案·元夕<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>西江月·夜行黄沙道中<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span>             </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需求：选择唐诗和宋词的第一个作者：</p>
<ul>
<li>父元素的第n个子节点<code>nth-child</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elements = wd.find_elements(By.CSS_SELECTOR, <span class="string">&#x27;span:nth-child(2)&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意理解，这里nth-child表示的是：该元素是父元素的第二个子元素，而不是span元素的第二个子元素。</p>
</blockquote>
<ul>
<li><p>父元素的倒数第n个子节点<code>nth-last-child</code></p>
</li>
<li><p>父元素的第几个某类型的子节点<code>nth-of-type</code></p>
</li>
</ul>
<p>上述需求还可以这样思考，选择的是 <code>第1个span类型</code> 的子元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">span:nth-of-type(1) # 选择的是第1个span类型的子元素 </span><br></pre></td></tr></table></figure>

<ul>
<li>父元素的倒数第几个某类型的子节点<code>nth-last-of-type</code></li>
<li>偶数节点和奇数节点<code>nth-child(even)</code>、<code>p:nth-child(odd)</code></li>
</ul>
<h6 id="兄弟节点选择"><a href="#兄弟节点选择" class="headerlink" title="兄弟节点选择"></a>兄弟节点选择</h6><p>上述需求还有一种思考方法，就是选择 h3 <code>后面紧跟着的兄弟节点</code> span。</p>
<ul>
<li>相邻兄弟节点选择 加号<code>+</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h3 + span</span><br></pre></td></tr></table></figure>

<ul>
<li>后续所有兄弟节点选择</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h3 ~ span</span><br></pre></td></tr></table></figure>

<h5 id="XPath选择器"><a href="#XPath选择器" class="headerlink" title="XPath选择器"></a>XPath选择器</h5><p>XPath (XML Path Language) 是由国际标准化组织W3C指定的，用来在 XML 和 HTML 文档中选择节点的语言。XPath选择器参考：<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/xpath/index.asp">XPath选择器参考手册</a>。</p>
<ul>
<li>有些场景 用 CSS 选择web 元素 很麻烦，而XPath 却比较方便。</li>
<li>另外 XPath 还有其他领域会使用到，比如 爬虫框架 Scrapy，手机App框架 Appium。</li>
</ul>
<p>XPath 语法中，整个HTML文档根节点用’&#x2F;‘表示，如果我们想选择的是根节点下面的html节点，则可以在F12搜索框输入<code>/html</code>。</p>
<h6 id="绝对路径选择"><a href="#绝对路径选择" class="headerlink" title="绝对路径选择"></a>绝对路径选择</h6><p>从根节点开始到某个节点，每层都依次写下来，每层之间用 <code>/</code> 分隔的表达式，就是某元素的绝对路径：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elements = driver.find_elements(By.XPATH, <span class="string">&quot;/html/body/div&quot;</span>)  <span class="comment"># 等价于 css表达式 html&gt;body&gt;div</span></span><br></pre></td></tr></table></figure>

<h6 id="相对路径选择"><a href="#相对路径选择" class="headerlink" title="相对路径选择"></a>相对路径选择</h6><p>选择网页中某个元素，不管它在什么位置，如果使用CSS表达式，直接写一个 <code>div</code> 就行了，XPath表达式应该这样写： <code>//div</code></p>
<h6 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h6><p>如果要选择所有div节点的所有直接子节点，可以使用表达式 <code>//div/*</code></p>
<h6 id="根据属性选择-1"><a href="#根据属性选择-1" class="headerlink" title="根据属性选择"></a>根据属性选择</h6><p>根据属性来选择元素的语法是 <code>[@属性名=&#39;属性值&#39;]</code></p>
<ul>
<li>根据id属性选择</li>
</ul>
<p>选择 id 为 west 的元素，可以这样 <code>//*[@id=&#39;west&#39;]</code></p>
<ul>
<li>根据class属性选择</li>
</ul>
<p>选择所有 select 元素中 class 为 single_choice 的元素，可以这样 <code>//select[@class=&#39;single_choice&#39;]</code></p>
<p>如果一个元素class 有多个，比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;beijing&quot;</span> <span class="attr">class</span>=<span class="string">&#x27;capital huge-city&#x27;</span>&gt;</span></span><br><span class="line">    北京    </span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>就应该是 <code>//p[@class=&quot;capital huge-city&quot;]</code>，不能只写一个属性。</p>
<ul>
<li>根据其他属性</li>
</ul>
<p>例如：选择具有multiple属性的所有页面元素 ，可以这样 <code>//*[@multiple]</code></p>
<ul>
<li>属性值包含字符串</li>
</ul>
<p>选择 style 属性值<strong>包含</strong> color 字符串的页面元素 ： <code>//*[contains(@style,&#39;color&#39;)]</code></p>
<p>选择 style 属性值以 color 字符串<strong>开头</strong>的 页面元素： <code>//*[starts-with(@style,&#39;color&#39;)]</code></p>
<p>如果是结尾呢？很遗憾，<code>ends-with</code>是XPath 2.0 的语法 ，目前浏览器都不支持。</p>
<h6 id="按次序选择"><a href="#按次序选择" class="headerlink" title="按次序选择"></a>按次序选择</h6><p>XPath 也可以根据次序选择元素。 语法比CSS更简洁，直接在方括号中使用数字表示次序。</p>
<p>选择 p 类型第2个的子元素：<code>//p[2]</code></p>
<ul>
<li>第几个子元素</li>
</ul>
<p>选择父元素为 div 的第2个子元素，不管是什么类型：<code>//div/*[2]</code></p>
<ul>
<li>某类型 倒数第几个子元素</li>
</ul>
<p>选取 p 类型倒数第<strong>1</strong>个子元素：<code>//p[last()]</code>；</p>
<p>选取 p 类型倒数第<strong>2</strong>个子元素：<code>//p[last()-1]</code>，数字是写在括号外面的；</p>
<h6 id="范围选择"><a href="#范围选择" class="headerlink" title="范围选择"></a>范围选择</h6><p>选取 option 类型第1到2个子元素：<code>//option[position()&lt;=2]</code></p>
<p>选择 class 属性为multi_choice的前3个子元素：<code>//*[@class=&#39;multi_choice&#39;]/*[position()&lt;=3]</code></p>
<p>选择 class 属性为multi_choice的后3个子元素：<code>//*[@class=multi_choice]/*[position()&gt;=last()-2]</code></p>
<h6 id="组选择、父节点、兄弟节点"><a href="#组选择、父节点、兄弟节点" class="headerlink" title="组选择、父节点、兄弟节点"></a>组选择、父节点、兄弟节点</h6><ul>
<li>组选择：用 竖线<code>|</code>隔开多个表达式</li>
</ul>
<p>选所有的option元素 和所有的 h4 元素：<code>//option | //h4</code></p>
<ul>
<li>选择父节点</li>
</ul>
<p>XPath可以选择父节点， 这是CSS做不到的。某个元素的父节点用 <code>/..</code> 表示。当某个元素没有特征可以直接选择，但是它有子节点有特征， 就可以采用这种方法，先选择子节点，再指定父节点。</p>
<p>选择 id 为 china 的节点的父节点： <code>//*[@id=&#39;china&#39;]/..</code></p>
<ul>
<li>兄弟节点选择</li>
</ul>
<p>语法 <code>following-sibling::</code>、<code>preceding-sibling::</code></p>
<p>选择 class 为 single_choice 的元素的所有后续兄弟节点 <code>//*[@class=&#39;single_choice&#39;]/following-sibling::*</code></p>
<blockquote>
<p>等同于CSS选择器 <code>.single_choice ~ *</code></p>
</blockquote>
<p>选择 class 为 single_choice 的元素的</p>
<p>前面第n最靠近的兄弟节点：<code>//*[@class=&#39;single_choice&#39;]/preceding-sibling::*[n]</code></p>
<blockquote>
<p>CSS目前还做不到</p>
</blockquote>
<blockquote>
<p>注意：要在某个元素内部使用XPath选择元素， 需要 在XPath表达式最前面加个点<code>.</code> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定位xxx元素内部的所有p元素</span></span><br><span class="line">element = wd.find_element(By.ID, <span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">elements = element.find_elements(By.XPATH, <span class="string">&#x27;.//p&#x27;</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="frame切换-窗口切换"><a href="#frame切换-窗口切换" class="headerlink" title="frame切换&#x2F;窗口切换"></a>frame切换&#x2F;窗口切换</h4><h5 id="frame-iframe"><a href="#frame-iframe" class="headerlink" title="frame&#x2F;iframe"></a>frame&#x2F;iframe</h5><p>在html语法中，frame 元素 或者iframe元素的内部 会包含一个 <strong>被嵌入的</strong> 另一份html文档。在我们使用selenium打开一个网页时， 我们的操作范围缺省是当前的 html ， 并不包含被嵌入的html文档里面的内容。</p>
<p>如果我们要 操作 被嵌入的 html 文档中的元素， 就必须 切换操作范围到被嵌入的文档中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wd.switch_to.frame(<span class="string">&#x27;frame1&#x27;</span>) <span class="comment"># 括号里可以是 frame 元素的属性 name 或者 ID ,也可以填写frame 所对应的 WebElement 对象。</span></span><br></pre></td></tr></table></figure>

<p>完成操作后切回主html：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wd.switch_to.default_content()</span><br></pre></td></tr></table></figure>

<h5 id="窗口切换"><a href="#窗口切换" class="headerlink" title="窗口切换"></a>窗口切换</h5><p>点击链接进入新窗口， WebDriver对象对应的 还是老窗口，自动化操作也还是在老窗口进行，更改方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wd.switch_to.window(handle)</span><br></pre></td></tr></table></figure>

<p>其中handle是WebDriver对象的window_handles 属性，这是一个列表对象， 里面包括了当前浏览器里面所有的窗口句柄，所谓句柄，可以理解为网页窗口对应的唯一ID。</p>
<p>这样，要切换到指定窗口就可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> wd.window_handles:</span><br><span class="line">    <span class="comment"># 先切换到该窗口</span></span><br><span class="line">    wd.switch_to.window(handle)</span><br><span class="line">    <span class="comment"># 得到该窗口的标题栏字符串，判断是不是我们要操作的那个窗口</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Bing&#x27;</span> <span class="keyword">in</span> wd.title:</span><br><span class="line">        <span class="comment"># 如果是，那么这时候WebDriver对象就是对应的该该窗口，正好，跳出循环，</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>要切回来的话，先保存原来的句柄：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mainWindow变量保存当前窗口的句柄</span></span><br><span class="line">mainWindow = wd.current_window_handle</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过前面保存的老窗口的句柄，自己切换到老窗口</span></span><br><span class="line">wd.switch_to.window(mainWindow)</span><br></pre></td></tr></table></figure>

<h4 id="选择框"><a href="#选择框" class="headerlink" title="选择框"></a>选择框</h4><h5 id="radio"><a href="#radio" class="headerlink" title="radio"></a>radio</h5><p>单选框直接点击即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;s_radio&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小江老师&quot;</span>&gt;</span>小江老师<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小雷老师&quot;</span>&gt;</span>小雷老师<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小凯老师&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span>&gt;</span>小凯老师</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取当前选中的元素</span></span><br><span class="line">element = wd.find_element(By.CSS_SELECTOR, </span><br><span class="line">  <span class="string">&#x27;#s_radio input[name=&quot;teacher&quot;]:checked&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;当前选中的是: &#x27;</span> + element.get_attribute(<span class="string">&#x27;value&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点选 小雷老师</span></span><br><span class="line">wd.find_element(By.CSS_SELECTOR, </span><br><span class="line">  <span class="string">&#x27;#s_radio input[value=&quot;小雷老师&quot;]&#x27;</span>).click()</span><br></pre></td></tr></table></figure>

<h5 id="checkbox"><a href="#checkbox" class="headerlink" title="checkbox"></a>checkbox</h5><p>复选框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先把 已经选中的选项全部点击一下，确保都是未选状态</span></span><br><span class="line">elements = wd.find_elements(By.CSS_SELECTOR, </span><br><span class="line">  <span class="string">&#x27;#s_checkbox input[name=&quot;teacher&quot;]:checked&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> elements:</span><br><span class="line">    element.click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再点击 小雷老师</span></span><br><span class="line">wd.find_element(By.CSS_SELECTOR, </span><br><span class="line">  <span class="string">&quot;#s_checkbox input[value=&#x27;小雷老师&#x27;]&quot;</span>).click()</span><br></pre></td></tr></table></figure>

<h5 id="select"><a href="#select" class="headerlink" title="select"></a>select</h5><p>select下拉框是一个新的select标签，对于select 选择框， Selenium专门提供了一个 Select类进行操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Select类</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Select对象</span></span><br><span class="line">select = Select(wd.find_element(By.ID, <span class="string">&quot;ss_single&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 Select 对象选中小雷老师</span></span><br><span class="line">select.select_by_visible_text(<span class="string">&quot;aaa&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Select类常用方法：</p>
<ul>
<li><p>select_by_value</p>
<p>根据元素的value属性来选择</p>
</li>
<li><p>select_by_index</p>
<p>从0开始</p>
</li>
<li><p>select_by_visible_text</p>
<p>根据可见文本选择</p>
</li>
<li><p>deselect_by_value、deselect_by_index、deselect_by_visible_text</p>
<p>取消选择</p>
</li>
<li><p>deselect_all</p>
</li>
</ul>
</blockquote>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><h5 id="等待方式"><a href="#等待方式" class="headerlink" title="等待方式"></a>等待方式</h5><p>在自动化测试脚本的运行过程中，webdriver操作浏览器的时候，对于元素的定位是有一定的超时时间，大致在1-3秒,如果这个时间内仍然定位不到元素，就会抛出异常，中止脚本运行，可以通过在脚本中设置等待的方式来避免由于网络延迟或浏览器卡顿导致的偶然失败。常用的等待方式有三种：强制等待、隐式等待、显示等待。</p>
<ul>
<li>强制等待</li>
</ul>
<p>强制等待是一种不建议使用的等待方式。它使用 <code>time.sleep()</code> 方法在代码中强制让程序等待固定的时间，而不管网页是否已经加载完成或元素是否已经出现。</p>
<p>缺点：</p>
<blockquote>
<p>1、时间浪费：强制的等待是由人为设置的固定时间，如果设置地过长，就会降低测试效率， 如果过短，则无法保证元素或页面加载完成，从而导致测试失败；</p>
<p>2、依赖于网络环境：网络环境的不稳定会导致页面元素加载时间的变化，如果使用固定的等待时间，就无法适应各种网络环境的差异</p>
<p>3、不灵活：强制等待是一种静态等待方式，无法根据实际情况动态调整等待时间。</p>
</blockquote>
<p>但是还是有其特定的使用场景：</p>
<blockquote>
<p>1、页面加载时间长且不稳定。但使用强制等待不是最佳实践，应该尽量优化页面加载速度和稳定性。</p>
<p>2、其他等待方式无法满足需求。确保没有其他替代方案时再使用强制等待。</p>
<p>3、调试代码。</p>
</blockquote>
<ul>
<li>隐式等待</li>
</ul>
<p>隐式等待是一种全局性的等待方式，在整个测试期间都有效。设置隐式等待，Selenium就会在定位元素时等待一段时间，如果元素没有立即出现，则继续等待一段时间。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.implicitly_wait() <span class="comment">#单位是秒</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<ul>
<li>隐式等待只对find_element()和find_elements()方法有效</li>
<li>使用显示等待时，隐式等待会被覆盖掉</li>
</ul>
</blockquote>
<p>缺点：</p>
<blockquote>
<ol>
<li>隐式等待只对 <code>find_element()</code> 和 <code>find_elements()</code> 方法有效，其他方法不受影响，因此可能会导致一些操作失败。</li>
<li>如果设置的隐式等待时间过长，会增加测试执行的总时间，从而降低测试效率。</li>
<li>高并发环境下，多个线程使用同一个驱动器对象时，隐式等待可能会互相干扰，从而导致测试失败。</li>
</ol>
</blockquote>
<blockquote>
<p>使用技巧：当需要查找的元素在不同的测试用例中都需要使用时，可以将隐式等待放到 <code>setUp()</code> 方法中，这样所有的测试用例都可以共享隐式等待的设置；</p>
</blockquote>
<ul>
<li>显示等待</li>
</ul>
<p>设置一个等待时间和等待条件，在规定时间内，每隔一段时间查看下条件是否成立，不成立会抛出一个超时异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="comment"># 导入selenium模块中的expected_conditions模块的EC别名，用于定义预期条件</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">wd = webdriver.Chrome()</span><br><span class="line">wd.get(<span class="string">&quot;localhost://5173&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待加载直到标题含有“注册”</span></span><br><span class="line">WebDriverWait(wd, <span class="number">5</span>).until(EC.title_contains(<span class="string">&quot;注册&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断元素在DOM中是否存在（不保证是否可见）</span></span><br><span class="line">locator = (By.ID, <span class="string">&quot;su&quot;</span>)</span><br><span class="line"></span><br><span class="line">WebDriverWait(wd, <span class="number">5</span>).until(EC.visibility_of_element_located(locator)) <span class="comment"># 等待5秒，5秒之内找到元素并且可见则返回true,否则报错</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用场景：</p>
<blockquote>
<p>1、等待页面元素加载完成</p>
<p>2、等待异步操作完成</p>
<p>3、等待某些特定条件达成</p>
</blockquote>
<p>缺点：</p>
<blockquote>
<p>1、代码复杂</p>
<p>2、容易出现异常，如果设置时间太短或者条件不正确都有可能出现异常。</p>
</blockquote>
<h5 id="更多动作"><a href="#更多动作" class="headerlink" title="更多动作"></a>更多动作</h5><p>鼠标右键点击、双击、移动鼠标到某个元素、鼠标拖拽等。这些操作，可以通过 Selenium 提供的 <code>ActionChains</code> 类来实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">ac = ActionChains(driver)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 鼠标移动到 元素上</span></span><br><span class="line">ac.move_to_element(</span><br><span class="line">    driver.find_element(By.CSS_SELECTOR, <span class="string">&#x27;[name=&quot;tj_briicon&quot;]&#x27;</span>)</span><br><span class="line">).perform()</span><br></pre></td></tr></table></figure>

<h5 id="直接执行javascript"><a href="#直接执行javascript" class="headerlink" title="直接执行javascript"></a>直接执行javascript</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接执行 javascript，里面可以直接用return返回我们需要的数据</span></span><br><span class="line">nextPageButtonDisabled = driver.execute_script(</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ele = document.querySelector(&#x27;.soupager &gt; button:last-of-type&#x27;);</span></span><br><span class="line"><span class="string">    return ele.getAttribute(&#x27;disabled&#x27;)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回的数据转化为Python中的数据对象进行后续处理</span></span><br><span class="line"><span class="keyword">if</span> nextPageButtonDisabled == <span class="string">&#x27;disabled&#x27;</span>: <span class="comment"># 是最后一页</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>: <span class="comment"># 不是最后一页</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>有时，自动化的网页内容很长，或者很宽，超过一屏显示，这时，可以调用 <code>execute_script</code> 直接执行js代码，让该元素出现在窗口可见区正中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.execute_script(<span class="string">&quot;arguments[0].scrollIntoView(&#123;block:&#x27;center&#x27;,inline:&#x27;center&#x27;&#125;)&quot;</span>, job)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中 <code>arguments[0]</code> 就指代了后面的第一个参数 <code>job</code> 对应的js对象，</p>
<p>js对象的 <code>scrollIntoView</code> 方法，就是让元素滚动到可见部分</p>
<p><code>block:&#39;center&#39;</code> 指定垂直方向居中</p>
<p><code>inline:&#39;center&#39;</code> 指定水平方向居中</p>
</blockquote>
<h5 id="冻结界面"><a href="#冻结界面" class="headerlink" title="冻结界面"></a>冻结界面</h5><p>对于hover效果，可以冻结界面然后操作，在开发者工具栏 console 里面执行如下js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">debugger</span>&#125;, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<h5 id="弹出对话框"><a href="#弹出对话框" class="headerlink" title="弹出对话框"></a>弹出对话框</h5><p>弹出的对话框有三种类型，分别是 Alert（警告信息）、confirm（确认信息）和prompt（提示输入）；</p>
<ul>
<li>Alert</li>
</ul>
<p>只需要点击确认就可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.alert.accept()</span><br></pre></td></tr></table></figure>

<p>如果要获取里面的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.alert.text</span><br></pre></td></tr></table></figure>

<ul>
<li>Confirm</li>
</ul>
<p>Confirm弹出框有两个选择供用户选择，分别是 OK 和 Cancel，分别代表确定和取消操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 确认还是用这个</span><br><span class="line">driver.switch_to.alert.accept()</span><br><span class="line"># 取消</span><br><span class="line">driver.switch_to.alert.dismiss()</span><br></pre></td></tr></table></figure>

<ul>
<li>Prompt</li>
</ul>
<p>Prompt 弹出框要用户输入一些信息，提交上去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.alert.send_keys()</span><br></pre></td></tr></table></figure>

<h5 id="窗口大小"><a href="#窗口大小" class="headerlink" title="窗口大小"></a>窗口大小</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driver.get_window_size() # 获取窗口大小</span><br><span class="line">driver.set_window_size(x, y) # 改变窗口大小</span><br></pre></td></tr></table></figure>

<h5 id="获取当前窗口标题"><a href="#获取当前窗口标题" class="headerlink" title="获取当前窗口标题"></a>获取当前窗口标题</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wd.title</span><br></pre></td></tr></table></figure>

<h5 id="获取当前窗口URL地址"><a href="#获取当前窗口URL地址" class="headerlink" title="获取当前窗口URL地址"></a>获取当前窗口URL地址</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wd.current_url</span><br></pre></td></tr></table></figure>

<h5 id="截屏"><a href="#截屏" class="headerlink" title="截屏"></a>截屏</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_file(&#x27;1.png&#x27;)</span><br></pre></td></tr></table></figure>

<h5 id="手机模式"><a href="#手机模式" class="headerlink" title="手机模式"></a>手机模式</h5><p>可以通过 <code>desired_capabilities</code> 参数，指定以手机模式打开chrome浏览器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">mobile_emulation = &#123; <span class="string">&quot;deviceName&quot;</span>: <span class="string">&quot;Nexus 5&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line"></span><br><span class="line">chrome_options.add_experimental_option(<span class="string">&quot;mobileEmulation&quot;</span>, mobile_emulation)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome( desired_capabilities = chrome_options.to_capabilities())</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">input</span>()</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h5 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h5><p>通常，网站页面上传文件的功能，是通过 <code>type</code> 属性 为 <code>file</code> 的 HTML <code>input</code> 元素实现的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; multiple=&quot;multiple&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>使用selenium自动化上传文件，我们只需要定位到该input元素，然后通过 send_keys 方法传入要上传的文件路径即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 先定位到上传文件的 input 元素</span><br><span class="line">ele = wd.find_element(By.CSS_SELECTOR, &#x27;input[type=file]&#x27;)</span><br><span class="line"></span><br><span class="line"># 再调用 WebElement 对象的 send_keys 方法</span><br><span class="line">ele.send_keys(r&#x27;h:\g01.png&#x27;)</span><br><span class="line">ele.send_keys(r&#x27;h:\g02.png&#x27;)</span><br></pre></td></tr></table></figure>

<p>但是，有的网页上传，是没有 file 类型 的 input 元素的，这时候如果是Windows上的自动化，可以采用 Windows 平台专用的方法，安装<code>pip install pypiwin32</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到点击上传的元素，点击</span></span><br><span class="line">driver.find_element(By.CSS_SELECTOR, <span class="string">&#x27;.dropzone&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>) <span class="comment"># 等待上传选择文件对话框打开</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接发送键盘消息给 当前应用程序，</span></span><br><span class="line"><span class="comment"># 前提是浏览器必须是当前应用</span></span><br><span class="line"><span class="keyword">import</span> win32com.client</span><br><span class="line">shell = win32com.client.Dispatch(<span class="string">&quot;WScript.Shell&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入文件路径，最后的&#x27;\n&#x27;，表示回车确定，也可能时 &#x27;\r&#x27; 或者 &#x27;\r\n&#x27;</span></span><br><span class="line">shell.Sendkeys(<span class="string">r&quot;h:\a2.png&quot;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<h2 id="API接口自动化"><a href="#API接口自动化" class="headerlink" title="API接口自动化"></a>API接口自动化</h2><h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p>HTTP 协议全称是超文本传输协议， 英文是 Hypertext Transfer Protocol 。HTTP 最初是用来 在 浏览器和网站服务器（web服务）之间 传输超文本（网页、视频、图片等）信息的。由于 HTTP 简洁易用，后来，不仅仅是浏览器和服务器之间使用它， 服务器和服务器之间， 手机App和服务器之间， 都广泛的采用。 成了软件系统间通信的首选协议之一。</p>
<p>HTTP 有好几个版本，包括： <code>0.9</code> 、 <code>1.0</code> 、 <code>1.1</code> 、 <code>2</code> 、 <code>3</code> ，当前最广泛使用的是 <code>HTTP/1.1</code> 版本。HTTP3 以前版本 （除了HTTP3基于UDP，准确来说是基于QUIC协议，QUIC是基于UDP的） , 都是 基于 TCP 协议的， 所以要进行通讯，客户端 必须先 和服务端 创建 TCP 连接。而且 HTTP 双方的信息交互，必须是这样一种方式：</p>
<ul>
<li>客户端 先发送 http请求（request）给 服务端</li>
<li>然后服务端 发送 http响应（response）给 客户端</li>
</ul>
<blockquote>
<p>特别注意：HTTP协议中，服务端不能主动先发送信息给 客户端。</p>
</blockquote>
<p>而且在1.1 以前的版本， 服务端 返回响应给客户端后，连接就会断开 ，下一次双方要进行信息交流，必须重复上面的过程，重新建立连接，客户端发送请求，服务返回响应。到了 1.1 版本， 建立连接后，这个连接可以保持一段时间（keep alive）， 这段时间，双方可以多次进行 请求和响应， 无需重新建立连接。</p>
<h3 id="HTTP请求消息"><a href="#HTTP请求消息" class="headerlink" title="HTTP请求消息"></a>HTTP请求消息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /mgr/login.html HTTP/1.1 # 请求行</span><br><span class="line">Host: www.baiyueheiyu.com # 以下为请求头</span><br><span class="line">User-Agent: Mozilla/6.0 (compatible; MSIE5.01; Windows NT)</span><br><span class="line">Accept-Language: zh-cn</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /api/medicine HTTP/1.1 # 请求行</span><br><span class="line">Host: www.baiyueheiyu.com # 以下为请求头</span><br><span class="line">User-Agent: Mozilla/6.0 (compatible; MSIE5.01; Windows NT)</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 51</span><br><span class="line">Accept-Language: zh-cn</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">name=qingmeisu&amp;sn=099877883837&amp;desc=qingmeisuyaopin # 消息体</span><br></pre></td></tr></table></figure>

<h4 id="请求行-request-line"><a href="#请求行-request-line" class="headerlink" title="请求行 request line"></a>请求行 request line</h4><p>包含请求方式、URL、协议版本</p>
<blockquote>
<p>请求方式</p>
<ul>
<li><strong>get、post、put、delete</strong>、head、options、trace、connect、patch等</li>
</ul>
</blockquote>
<h4 id="请求头-request-headers"><a href="#请求头-request-headers" class="headerlink" title="请求头 request headers"></a>请求头 request headers</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">MDN关于请求头标准的描述</a></p>
<p>单个请求头的 格式是：名字: 值，一个请求头占据一行，开发者也可以在HTTP消息中添加自己定义的请求头。</p>
<h4 id="消息体-message-body"><a href="#消息体-message-body" class="headerlink" title="消息体 message body"></a>消息体 message body</h4><p>POST、PUT等请求，添加、修改的数据信息通常都是存放在请求消息体中的。消息头和消息体之间需要插入一个空行隔开。</p>
<p>请求消息体通常是某种格式的文本，常见的有：</p>
<ul>
<li>JSON</li>
<li>Xml</li>
<li>www-form-urlencoded 表单数据</li>
</ul>
<h3 id="HTTP响应消息"><a href="#HTTP响应消息" class="headerlink" title="HTTP响应消息"></a>HTTP响应消息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK # 状态行</span><br><span class="line">Date: Thu, 19 Sep 2019 08:08:27 GMT</span><br><span class="line">Server: WSGIServer/0.2 CPython/3.7.3</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 37</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">&#123;&quot;ret&quot;: 0, &quot;retlist&quot;: [], &quot;total&quot;: 0&#125;</span><br></pre></td></tr></table></figure>

<h4 id="状态行-status-line"><a href="#状态行-status-line" class="headerlink" title="状态行 status line"></a>状态行 status line</h4><blockquote>
<p>状态码</p>
<ul>
<li>2xx</li>
</ul>
<p>通常表示请求消息没有问题，而且服务器也正确处理了;</p>
<ul>
<li>3xx</li>
</ul>
<p>重定向响应，常见的值是301，302， 表示客户端的这个请求的url地址已经改变了， 需要客户端重新发起一个请求到另外的一个url。</p>
<ul>
<li>4xx</li>
</ul>
<p>表示客户端请求有错误， 常见的值有：</p>
<p><code>400 Bad Request</code> 表示客户端请求不符合接口要求，比如格式完全错误；</p>
<p><code>401 Unauthorized</code> 表示客户端需要先认证才能发送次请求；</p>
<p><code>403 Forbidden</code> 表示客户端没有权限要求服务器处理这样的请求， 比如普通用户请求删除别人账号等；</p>
<p><code>404 Not Found</code> 表示客户端请求的url 不存在；</p>
<ul>
<li>5xx</li>
</ul>
<p>表示服务端在处理请求中，发生了未知的错误。</p>
<p>通常是服务端的代码设计问题，或者是服务端子系统出了故障（比如数据库服务宕机了）</p>
</blockquote>
<h4 id="响应头-response-headers"><a href="#响应头-response-headers" class="headerlink" title="响应头 response headers"></a>响应头 response headers</h4><p>作用与请求头类似。</p>
<h4 id="消息体-message-body-1"><a href="#消息体-message-body-1" class="headerlink" title="消息体 message body"></a>消息体 message body</h4><h3 id="接口测试概述"><a href="#接口测试概述" class="headerlink" title="接口测试概述"></a>接口测试概述</h3><p>API接口传递数据信息是通过HTTP协议进行收发的 ， 网站获取网页、图片 、CSS 等资源， 也是通过HTTP协议进行收发的 。</p>
<p>两者的不同点在于，网页、图片、css 这些资源，都是静态资源 ，服务端直接读取文件，返回给客户端即可，无需特别的数据处理。而 API接口请求消息，通常都需要 服务端程序进行一番处理，比如：对请求的权限检查，从数据库中读出数据，进行信息过滤和格式转换，最后在HTTP响应中返回给客户端。</p>
<p>内部接口通常是由开发来做，测试来做内部API的接口测试时，重点是做<strong>漏洞测试</strong>和<strong>破坏性测试</strong>就好了。而外部接口，也就是第三方接口。 测试工程师一定要进行全面测试。</p>
<h3 id="Requests库"><a href="#Requests库" class="headerlink" title="Requests库"></a>Requests库</h3><p><a target="_blank" rel="noopener" href="https://requests.readthedocs.io/en/latest/">requests官网</a></p>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 返回Response对象</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://mirrors.sohu.com/&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h4 id="requests程序抓包设置代理为Fiddler"><a href="#requests程序抓包设置代理为Fiddler" class="headerlink" title="requests程序抓包设置代理为Fiddler"></a>requests程序抓包设置代理为Fiddler</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8888&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8888&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://mirrors.sohu.com/&#x27;</span>, proxies=proxies)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>还需要安装Fiddler证书，然后执行命令 <code>pip install python-certifi-win32</code> 安装一个第三方库 ，这样会让python使用本地系统安装的证书。</p>
<h4 id="构建请求参数-params"><a href="#构建请求参数-params" class="headerlink" title="构建请求参数 params"></a>构建请求参数 <strong>params</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpara = &#123;</span><br><span class="line">    <span class="string">&#x27;wd&#x27;</span>:<span class="string">&#x27;iphone&amp;ipad&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rsv_spt&#x27;</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.baidu.com/s&#x27;</span>,params=urlpara)</span><br></pre></td></tr></table></figure>

<h4 id="构建请求消息头-headers"><a href="#构建请求消息头-headers" class="headerlink" title="构建请求消息头 headers"></a>构建请求消息头 <strong>headers</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;my-app/0.0.1&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;auth-type&#x27;</span>: <span class="string">&#x27;jwt-token&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<h4 id="构建请求消息体-data"><a href="#构建请求消息体-data" class="headerlink" title="构建请求消息体 data"></a>构建请求消息体 <strong>data</strong></h4><p>消息体可能很短 ，只有一个字节， 比如字符 a。 也可能很长，有几百兆个字节，比如一个视频文件。最常见的消息体格式当然是表示网页内容的 HTML。</p>
<p>消息体就是存放信息的地方，信息的格式完全取决设计者的需要。而Web API接口中，消息体基本都是文本，文本的格式主要是这3种： urlencoded ，JSON ，XML。</p>
<h5 id="XML格式"><a href="#XML格式" class="headerlink" title="XML格式"></a><strong>XML格式</strong></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;WorkReport&gt;</span></span><br><span class="line"><span class="string">    &lt;Overall&gt;良好&lt;/Overall&gt;</span></span><br><span class="line"><span class="string">    &lt;Progress&gt;30%&lt;/Progress&gt;</span></span><br><span class="line"><span class="string">    &lt;Problems&gt;暂无&lt;/Problems&gt;</span></span><br><span class="line"><span class="string">&lt;/WorkReport&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>,</span><br><span class="line">                 data=payload.encode(<span class="string">&#x27;utf8&#x27;</span>)) <span class="comment"># 缺省会使用latin-1编码</span></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<h5 id="urlencoded-格式消息体"><a href="#urlencoded-格式消息体" class="headerlink" title="urlencoded 格式消息体"></a><strong>urlencoded 格式消息体</strong></h5><p>这种格式的消息体就是一种键值对的格式存放数据，可以放到字典里传递。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;<span class="string">&#x27;key1&#x27;</span>: <span class="string">&#x27;value1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>: <span class="string">&#x27;value2&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>, data=payload)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<h5 id="JSON-格式消息体"><a href="#JSON-格式消息体" class="headerlink" title="JSON 格式消息体"></a><strong>JSON 格式消息体</strong></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;Overall&quot;</span>:<span class="string">&quot;良好&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Progress&quot;</span>:<span class="string">&quot;30%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Problems&quot;</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;No&quot;</span> : <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;问题1....&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;No&quot;</span> : <span class="number">2</span>,</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;问题2....&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>, data=json.dumps(payload)) <span class="comment"># 使用json库的dumps方法构建json对象</span></span><br></pre></td></tr></table></figure>

<p>也可以将数据对象直接传递给 post 方法的 json 参数，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>, json=payload)</span><br></pre></td></tr></table></figure>

<h4 id="检查响应状态码"><a href="#检查响应状态码" class="headerlink" title="检查响应状态码"></a>检查响应状态码</h4><p><code>response.status_code</code></p>
<h4 id="检查响应消息头"><a href="#检查响应消息头" class="headerlink" title="检查响应消息头"></a>检查响应消息头</h4><p><code>response.headers</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,pprint</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://mirrors.sohu.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(response.headers))</span><br><span class="line"></span><br><span class="line">pprint.pprint(<span class="built_in">dict</span>(response.headers))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>pprint可以更美观的打印数据，直观的展示数据结构</p>
</blockquote>
<h4 id="检查响应消息体"><a href="#检查响应消息体" class="headerlink" title="检查响应消息体"></a>检查响应消息体</h4><p><code>response.text</code></p>
<p>equests 会根据响应消息头（比如 Content-Type）对编码格式做推测，从而包响应消息体中的字节串解码为字符串，但是有时没有指定编码格式，就需要手动指定：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://mirrors.sohu.com/&#x27;</span>)</span><br><span class="line">response.encoding=<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>要直接获取消息体中的字节串内容，可以使用 <code>response.content</code>。有需要时指定解码方式：<code>response.content.decode(&#39;utf8&#39;)</code>。</p>
</li>
<li><p>对于JSON格式的消息体，可以通过json库的loads函数，把它转化为JSON对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line">response = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>, data=&#123;<span class="number">1</span>:<span class="number">1</span>,<span class="number">2</span>:<span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line">obj = json.loads(response.content.decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(obj)</span><br></pre></td></tr></table></figure>

<p>requests库为我们提供了更方便的方法，可以使用 Response对象的 json方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj = response.json()</span><br><span class="line"><span class="built_in">print</span>(obj)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>前面学习过Cookie，客户端访问服务器时，服务器会生成唯一id，并通过HTTP响应头的<code>Set-Cookie</code>字段响应给客户端，这个唯一id就是sessionid。在生成sessionid的同时，服务器还生成了session这样一个数据结构，保存该客户这次登录操作相关信息。通常保存在数据库中。</p>
<h3 id="requests处理session-Cookie"><a href="#requests处理session-Cookie" class="headerlink" title="requests处理session-Cookie"></a>requests处理session-Cookie</h3><p>equests库给我们提供一个 <code>Session</code> 类 。通过这个类，无需我们操心， requests库自动帮我们保存服务端返回的 cookie数据， HTTP请求自动 在消息头中放入 cookie 数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Session 对象</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 Session 对象 发送请求</span></span><br><span class="line">response = s.post(<span class="string">&quot;http://127.0.0.1/api/mgr/signin&quot;</span>,</span><br><span class="line">       data=&#123;</span><br><span class="line">           <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;byhy&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;88888888&#x27;</span></span><br><span class="line">       &#125;)</span><br><span class="line"></span><br><span class="line">printResponse(response) </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还可以这样写，没有上面简洁</span></span><br><span class="line">req = requests.Request(</span><br><span class="line">    <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.baidu.com&#x27;</span>,</span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;head1&#x27;</span>:<span class="string">&#x27;value1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;head2&#x27;</span>:<span class="string">&#x27;value2&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;item1&#x27;</span>:<span class="string">&#x27;body-value1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;item2&#x27;</span>:<span class="string">&#x27;body-value2&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment">#  如果这样写 prepared = req.prepare() </span></span><br><span class="line"><span class="comment">#  后续发送会 请求消息头中，会丢掉session中的cookie数据</span></span><br><span class="line"><span class="comment">#  必须像下面这样写，才能让请求包含cookie数据</span></span><br><span class="line">prepared = session.prepare_request(req)</span><br><span class="line"></span><br><span class="line">pretty_print_request(prepared)</span><br><span class="line">r = session.send(prepared)</span><br><span class="line">pretty_print_response(r)</span><br></pre></td></tr></table></figure>

<h3 id="Session对象使用代理"><a href="#Session对象使用代理" class="headerlink" title="Session对象使用代理"></a>Session对象使用代理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8888&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line">s.proxies.update(proxies)</span><br><span class="line"></span><br><span class="line">s.get(<span class="string">&quot;http://www.example.com&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="接口测试数据准备"><a href="#接口测试数据准备" class="headerlink" title="接口测试数据准备"></a>接口测试数据准备</h3><p>如果测试的时候，系统前端已经开发完毕，在前端删除。否则可以通过 API 删除接口删除。</p>
<p>尽量不要在数据库中直接删除数据。</p>
<h3 id="封装API测试类"><a href="#封装API测试类" class="headerlink" title="封装API测试类"></a>封装API测试类</h3><p>可以把发送接收API消息封装到库中，这样可以使我们的测试代码更加简洁。比如，我们可以创建一个 webapi.py的库：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span>  pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIMgr</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_printResponse</span>(<span class="params">self,response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n\n-------- HTTP response * begin -------&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(response.status_code)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> response.headers.items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;k&#125;</span>: <span class="subst">&#123;v&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(response.content.decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-------- HTTP response * end -------\n\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mgr_login</span>(<span class="params">self,username,password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.s = requests.Session()</span><br><span class="line">        response = <span class="variable language_">self</span>.s.post(<span class="string">&quot;http://127.0.0.1/api/mgr/signin&quot;</span>,</span><br><span class="line">                                 data=&#123;</span><br><span class="line">                                     <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">                                     <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">                                 &#125;</span><br><span class="line">                                 )</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._printResponse(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">customer_list</span>(<span class="params">self,pagesize,pagenumber,keywords</span>):</span><br><span class="line">        response = <span class="variable language_">self</span>.s.get(<span class="string">&quot;http://127.0.0.1/api/mgr/customers&quot;</span>,</span><br><span class="line">              params=&#123;</span><br><span class="line">                  <span class="string">&#x27;action&#x27;</span> :<span class="string">&#x27;list_customer&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;pagesize&#x27;</span> :pagesize,</span><br><span class="line">                  <span class="string">&#x27;pagenum&#x27;</span> :pagenumber,</span><br><span class="line">                  <span class="string">&#x27;keywords&#x27;</span> :keywords,</span><br><span class="line">              &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._printResponse(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> webapi <span class="keyword">import</span> APIMgr</span><br><span class="line">am = APIMgr()</span><br><span class="line">am.mgr_login(<span class="string">&#x27;byhy&#x27;</span>,<span class="string">&#x27;88888888&#x27;</span>)</span><br><span class="line">am.customer_list(<span class="number">1</span>,<span class="number">10</span>,<span class="string">&#x27;&#x27;</span>).</span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>我们注意到，webapi.py 库文件里面发送API 请求，都是写死了请求的 url ，这样做的问题是，如果我们测试系统安装在另外的机器上，这些代码都得更改IP地址。</p>
<p>所以，我们应该把被测系统的主机地址写在配置文件 <code>cfg/cfg.py</code> 中，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target_host = &#x27;127.0.0.1&#x27;</span><br></pre></td></tr></table></figure>

<p>然后，其他代码使用配置文件里面的主机地址，像这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cfg <span class="keyword">import</span> cfg</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;登录&#x27;</span>)</span><br><span class="line">response = <span class="variable language_">self</span>.s.post(</span><br><span class="line">    <span class="string">f&quot;http://<span class="subst">&#123;cfg.target_host&#125;</span>/api/mgr/signin&quot;</span>,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="自动化测试框架Pytetst"><a href="#自动化测试框架Pytetst" class="headerlink" title="自动化测试框架Pytetst"></a>自动化测试框架Pytetst</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>基于 Python 语言的自动化测试框架 最知名的 有如下 3 款：</p>
<ul>
<li>unittest</li>
<li>pytest</li>
<li>robotframework</li>
</ul>
<p>前两款框架主要（或者说很大程度上）是 聚焦 在 白盒单元测试。</p>
<p>而 robotframework 主要聚焦在系统测试。</p>
<p>pytest 可以用来做 系统测试 的自动化， 它的特点有：</p>
<ul>
<li>用 Python 编写测试用例，简便易用</li>
<li>可以用 <strong>文件系统目录层次 对应 手工测试用例 层次</strong>结构</li>
<li>灵活的 <strong>初始化清除</strong> 机制</li>
<li>可以<strong>灵活挑选测试用例</strong>执行</li>
<li>利用第三方插件，可以<strong>生成不错的报表</strong></li>
</ul>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>pip安装即可</p>
<h3 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h3><ul>
<li><p>编写的测试用例代码文件， 必须以 <code>test_</code> 开头，或者以 <code>_test</code> 结尾；</p>
</li>
<li><p>如果把测试用例存放在类中， 类名必须以 <code>Test</code> 为前缀的 <code>类</code> ，用例对应的方法必须以 <code>test</code> 为前缀的方法。</p>
</li>
<li><p>pytest 中用例的检查点 直接用 Python 的 assert 断言。</p>
</li>
<li><p>进入项目根录，执行pytest即可</p>
</li>
</ul>
<blockquote>
<p>注意：直接执行 <code>pytest</code> 命令不会将当前目录设置为模块搜索路径，所以更推荐 执行命令 <code>python -m pytest</code></p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pytest -s //打印测试代码中<span class="built_in">print</span>的内容 -v //打印详细的执行信息如测试类、测试函数的名字 +目标扫描目录路径 --html=report.html --self-contained-html //产生测试报告</span><br></pre></td></tr></table></figure>

<h3 id="初始化清除"><a href="#初始化清除" class="headerlink" title="初始化清除"></a>初始化清除</h3><p>对自动化测试框架来说，初始化清除功能至关重要。</p>
<h5 id="模块级别"><a href="#模块级别" class="headerlink" title="模块级别"></a>模块级别</h5><p>模块级别的初始化、清除分别在整个模块的测试用例执行前后执行，并且只会执行1次 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">setup_module</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n *** 初始化-模块 ***&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">teardown_module</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n ***   清除-模块 ***&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_xxx</span>:</span><br><span class="line">    ... ...</span><br></pre></td></tr></table></figure>

<h5 id="类级别"><a href="#类级别" class="headerlink" title="类级别"></a>类级别</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test_错误密码</span>:</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod </span><span class="comment"># 类方法装饰器</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_class</span>(<span class="params">cls</span>): <span class="comment"># 第一个参数固定为cls,而不是self</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n === 初始化-类 ===&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">teardown_class</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n === 清除 - 类 ===&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_C001001</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n用例C001001&#x27;</span>)</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>类方法装饰器</p>
<p>可以通过类名.方法名调用该方法</p>
<p>第一个参数固定为cls,而不是self</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计类创建了多少个实例</span></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_count</span>(<span class="params">cls</span>):	</span><br><span class="line">	<span class="keyword">return</span> cls.count</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从字符串构造对象，类方法可以替代构造方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_string</span>(<span class="params">cls, string</span>):</span><br><span class="line">        name, age = string.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> cls(name, <span class="built_in">int</span>(age))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据不同的类型参数返回不同的子类对象。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, color</span>):</span><br><span class="line">        <span class="variable language_">self</span>.color = color</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_color</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Color: <span class="subst">&#123;self.color&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_shape</span>(<span class="params">cls, color, <span class="built_in">type</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&quot;circle&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> Circle(color)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">type</span> == <span class="string">&quot;rectangle&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> Rectangle(color)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_shape</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type: Circle&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_shape</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type: Rectangle&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="方法级别"><a href="#方法级别" class="headerlink" title="方法级别"></a>方法级别</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类中，没有类方法装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_method</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n --- 初始化-方法  ---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">teardown_method</span>(<span class="params">self</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;\n --- 清除  -方法 ---&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_C001001</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n用例C001001&#x27;</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="目录级别"><a href="#目录级别" class="headerlink" title="目录级别"></a>目录级别</h4><p>在需要初始化的目录下面创建 一个名为 <code>conftest.py</code> 的文件，里面内容如下所示，这是一个生成器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest </span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;package&#x27;</span>,autouse=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">st_emptyEnv</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;\n#### 初始化-目录甲&#x27;</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">	<span class="comment"># 在这里写清除环境的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;\n#### 清除-目录甲&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="挑选用例执行"><a href="#挑选用例执行" class="headerlink" title="挑选用例执行"></a>挑选用例执行</h3><h4 id="指定一个模块"><a href="#指定一个模块" class="headerlink" title="指定一个模块"></a>指定一个模块</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pytest cases\登录\test_错误登录.py</span><br></pre></td></tr></table></figure>

<h4 id="指定一个或多个目录"><a href="#指定一个或多个目录" class="headerlink" title="指定一个或多个目录"></a>指定一个或多个目录</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pytest cases1  cases2\登录</span><br></pre></td></tr></table></figure>

<h4 id="指定模块里面的函数或者类"><a href="#指定模块里面的函数或者类" class="headerlink" title="指定模块里面的函数或者类"></a>指定模块里面的函数或者类</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 指定一个类</span><br><span class="line">python -m pytest cases\登录\test_错误登录.py::Test_错误密码</span><br><span class="line"></span><br><span class="line"># 指定类中的方法</span><br><span class="line">python -m pytest cases\登录\test_错误登录.py::Test_错误密码::test_C001001</span><br></pre></td></tr></table></figure>

<h4 id="根据名字"><a href="#根据名字" class="headerlink" title="根据名字"></a>根据名字</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python -m pytest -k C001001 -s # C001001可以是要测试函数名字的一部分，并且可以用and、<span class="keyword">not</span>和or来进行筛选</span><br><span class="line"></span><br><span class="line">python -m pytest -k &quot;<span class="keyword">not</span> C001001&quot; -s</span><br><span class="line">python -m pytest -k &quot;错 and 密码<span class="number">2</span>&quot; -s</span><br><span class="line">python -m pytest -k &quot;错 or 密码<span class="number">2</span>&quot; -s</span><br></pre></td></tr></table></figure>

<h4 id="根据标签"><a href="#根据标签" class="headerlink" title="根据标签"></a>根据标签</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_错误密码2</span>:</span><br><span class="line"></span><br><span class="line"><span class="meta">    @pytest.mark.webtest</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_C001021</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n用例C001021&#x27;</span>)</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>执行命令</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pytest cases -m webtest -s</span><br></pre></td></tr></table></figure>

<p>也可以给整个类加上标签，并且可以是中文，可以添加多个标签。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.webtest</span></span><br><span class="line"><span class="meta">@pytest.mark.登录测试</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_错误密码2</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_C001021</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n用例C001021&#x27;</span>)</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> == <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>可以这样定义一个全局变量 pytestmark 为<strong>整个模块文件</strong>设定标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">pytestmark = pytest.mark.网页测试</span><br></pre></td></tr></table></figure>

<p>如果需要定义多个标签，可以定义一个列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line">pytestmark = [pytest.mark.网页测试, pytest.mark.登录测试]</span><br></pre></td></tr></table></figure>

<p>自定义的标签，运行时，pytest会有告警。</p>
<p>可以在项目根目录下创建配置文件 <code>pytest.ini</code> 并且在里面设置标签配置项，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">markers =</span><br><span class="line">    critical: critical tests</span><br><span class="line">    网页测试: 标记为网页测试</span><br></pre></td></tr></table></figure>

<h3 id="数据驱动"><a href="#数据驱动" class="headerlink" title="数据驱动"></a>数据驱动</h3><p>如果有一批测试用例，具有相同的测试步骤 ，只是测试参数数据不同。自动化测试时，把测试数据从用例代码中分离开来，以后增加新的测试用例，只需要修改数据，这就是数据驱动。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test_错误登录</span>:</span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&#x27;username, password, expectedalert&#x27;</span>, [</span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="literal">None</span>, <span class="string">&#x27;88888888&#x27;</span>, <span class="string">&#x27;请输入用户名&#x27;</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="string">&#x27;byhy&#x27;</span>, <span class="literal">None</span>, <span class="string">&#x27;请输入密码&#x27;</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="string">&#x27;byh&#x27;</span>, <span class="string">&#x27;88888888&#x27;</span>, <span class="string">&#x27;登录失败 : 用户名或者密码错误&#x27;</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="string">&#x27;byhy&#x27;</span>, <span class="string">&#x27;8888888&#x27;</span>, <span class="string">&#x27;登录失败 : 用户名或者密码错误&#x27;</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">        (<span class="params"><span class="string">&#x27;byhy&#x27;</span>, <span class="string">&#x27;888888888&#x27;</span>, <span class="string">&#x27;登录失败 : 用户名或者密码错误&#x27;</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">    ]</span></span></span><br><span class="line"><span class="params"><span class="meta">                             </span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_UI_0001_0005</span>(<span class="params">self, username, password, expectedalert</span>):</span><br><span class="line">        alertText = loginAndCheck(username, password)</span><br><span class="line">        <span class="keyword">assert</span> alertText == expectedalert</span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://docs.pytest.org/en/latest/how-to/parametrize.html">pytest官网数据驱动</a></p>
<h3 id="fixture"><a href="#fixture" class="headerlink" title="fixture"></a>fixture</h3><p>前面讲初始化清除时，主要用的是 unittest 风格的初始化清除方法。pytest里面有更灵活方便的初始化、清除 方法，就是使用 <code>fixture</code>。跟spring的依赖注入类似。</p>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个fixture函数</span></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createzhangSan</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n ***  执行创建张三账号的代码 ***&#x27;</span>)</span><br><span class="line">    zhangSan = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>   : <span class="string">&#x27;zhangsan&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>   : <span class="string">&#x27;111111&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;invitecode&#x27;</span> : <span class="string">&#x27;abcdefg&#x27;</span> <span class="comment"># 这是系统创建用户产生的其它信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> zhangSan <span class="comment"># 用yield代替return</span></span><br><span class="line">	<span class="comment"># 这里写清除部分的代码</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n ***  执行清除张三账号的代码 ***&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_A001001</span>(<span class="params">createzhangSan</span>): <span class="comment"># 参数为fixture函数名，这样</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n用例 A001001&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\ninvitecode is&#x27;</span>, createzhangSan[<span class="string">&#x27;invitecode&#x27;</span>])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>fixture使用到python的 生成器 语法，所谓生成器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def test()</span><br><span class="line">	print(&#x27;123&#x27;)</span><br><span class="line">	yield</span><br><span class="line">	</span><br><span class="line">	print(&#x27;456&#x27;)</span><br><span class="line"># 正常不加yield，代码是顺序执行的，加上后变成类似setup和setdown分步执行。</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="fixture本身需要参数"><a href="#fixture本身需要参数" class="headerlink" title="fixture本身需要参数"></a>fixture本身需要参数</h4><p>就需要使用parametrize装饰器，并指定参数<code>indirect=True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个fixture函数</span></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createUser</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 这里代码实现了使用API创建用户账号功能</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n *** createUser ***&#x27;</span>)</span><br><span class="line">    user = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>   : request.param[<span class="number">0</span>],</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>   : request.param[<span class="number">1</span>],</span><br><span class="line">        <span class="string">&#x27;invitecode&#x27;</span> : <span class="string">&#x27;abcdefg&#x27;</span> <span class="comment"># 这是系统创建用户产生的其它信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;createUser&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                         [(<span class="params"><span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;111&quot;</span></span>)],</span></span></span><br><span class="line"><span class="params"><span class="meta">                         indirect=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_A001001</span>(<span class="params">createUser</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n用例 A001001&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nusername is&#x27;</span>, createUser[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;测试行为1111&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;createUser&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                         [(<span class="params"><span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;111&quot;</span></span>)],</span></span></span><br><span class="line"><span class="params"><span class="meta">                         indirect=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_A001002</span>(<span class="params">createUser</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n用例 A001002&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nusername is&#x27;</span>, createUser[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;测试行为2222&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里fixture参数request是特殊的名字，是pytest内置的fixture SubRequest对象，这个对象的param属性是一个tuple，里面保存了传入的一个个参数。</p>
</blockquote>
<h4 id="fixture范围"><a href="#fixture范围" class="headerlink" title="fixture范围"></a>fixture范围</h4><p>fixture 由小到大，有下面这几种级别范围：</p>
<ul>
<li><code>function</code> : 函数级别，缺省值</li>
</ul>
<p>会在测试函数结束时执行 fixture 对应的清除</p>
<ul>
<li><code>class</code> : 类级别</li>
</ul>
<p>会在 类 里面的最后一个测试方法 结束时 执行 fixture 对应的清除</p>
<ul>
<li><code>module</code> : 模块文件级别</li>
</ul>
<p>会在 模块文件 里面的最后一个测试方法 结束时 执行 fixture 对应的清除</p>
<ul>
<li><code>package</code> : 目录级别</li>
</ul>
<p>会在 目录 里面的最后一个测试方法 结束时 执行 fixture 对应的清除</p>
<ul>
<li><code>session</code> : 整个测试级别</li>
</ul>
<p>会在 整个测试 的最后一个测试方法 结束时 执行 fixture 对应的清除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;function&#x27;</span> autouse=<span class="literal">False</span></span>) </span></span><br><span class="line"><span class="comment"># scope缺省为function，函数级别</span></span><br><span class="line"><span class="comment"># autouse参数的作用为是否设置默认使用fixture，设置为True后，就不用在用例方法的参数中写上fixture函数名了，会自动调用。</span></span><br><span class="line"><span class="keyword">def</span> ...</span><br></pre></td></tr></table></figure>

<h4 id="conftest-py"><a href="#conftest-py" class="headerlink" title="conftest.py"></a>conftest.py</h4><p>全局fixture文件，将fixture放到此文件中，就可以在全局使用fixture。</p>
<h3 id="mark"><a href="#mark" class="headerlink" title="mark"></a>mark</h3><p>1、注册标记</p>
<p>在项目根目录中创建<code>pytest.ini</code>配置文件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pytest]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">markers</span> = </span><br><span class="line">	api</span><br><span class="line">	ui</span><br><span class="line">	ut 单元测试</span><br><span class="line">	e2e 端对端</span><br></pre></td></tr></table></figure>

<p>2、打上标记</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.api</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_shopping</span>:</span><br><span class="line">	</span><br><span class="line"><span class="meta">	@pytest.mark.e2e</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">test_login</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">assert</span> <span class="number">1</span> == <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>3、筛选标记</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytest -m api -m ut #可筛选多个模块的用例</span><br></pre></td></tr></table></figure>

<h3 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h3><p>通过hook可以改变pytest原有的运行方式。</p>
<p>例如：用yaml组织用例时，pytest原本无法识别，但通过hook，就可以调用了：</p>
<p>创建yaml文件组织用例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test_name:</span> <span class="string">abc</span></span><br><span class="line"><span class="attr">setp:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">a:</span> <span class="number">2</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">b:</span> <span class="number">4</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">c:</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>在pytest.ini中添加 <code>run_yaml_case = 1</code></p>
<p>创建hook：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 在合适的时机pytest会自动调用</span><br><span class="line">def pytest_yaml_run_step(item):</span><br><span class="line">	step = item.current_step</span><br><span class="line">	print(&quot;yaml中的用例步骤&quot;, step)</span><br><span class="line">	a = step[&#x27;a&#x27;]</span><br><span class="line">	b = step[&#x27;b&#x27;]</span><br><span class="line">	c = step[&#x27;c&#x27;]</span><br><span class="line">	assert a+b==c</span><br></pre></td></tr></table></figure>

<p>pytest运行脚本即可。</p>
<h3 id="框架封装"><a href="#框架封装" class="headerlink" title="框架封装"></a>框架封装</h3><h4 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a>日志记录</h4><p><a target="_blank" rel="noopener" href="https://docs.pytest.org/en/stable/how-to/logging.html">pytest日志管理官方文档</a></p>
<p>修改配置文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="C:\Users\31631\AppData\Roaming\Typora\typora-user-images\image-20250218165545313.png" alt="image-20250218165545313"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">log_file = ./logs/pytest.log</span><br><span class="line">log_file_level = info</span><br><span class="line">log_file_format =  %(levelname)-8s %(asctime)s [%(name)s:%(lineno)s] :%(message)s </span><br><span class="line">log-date-format=&quot;%Y-%m-%d %H:%M:%S&quot;</span><br><span class="line"></span><br><span class="line">result_log_enable = 1</span><br><span class="line">result_log_separator = 1</span><br><span class="line">result_log_level_separator = warning</span><br><span class="line">result_log_level_verbose = info</span><br></pre></td></tr></table></figure>

<h4 id="生成测试报告"><a href="#生成测试报告" class="headerlink" title="生成测试报告"></a>生成测试报告</h4><p>结合allure生成测试报告。</p>
<p>修改配置文件添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addopts = --alluredir=./temps --clean-alluredir </span><br></pre></td></tr></table></figure>

<p>执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allure generate -o allure_reports temps # 根据temps目录中生成的测试数据生成测试报告，并保存在allure_reports目录下</span><br></pre></td></tr></table></figure>

<h4 id="一键执行脚本"><a href="#一键执行脚本" class="headerlink" title="一键执行脚本"></a>一键执行脚本</h4><p>创建run.py文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># coding=utf-8 </span><br><span class="line"> </span><br><span class="line">import pytest</span><br><span class="line">import os</span><br><span class="line"> </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    pytest.main() # 启动框架</span><br><span class="line">    os.system(&quot;allure generate -o allure-report&quot;)</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h4 id="根据业务补充代码"><a href="#根据业务补充代码" class="headerlink" title="根据业务补充代码"></a>根据业务补充代码</h4><p>举例：接口自动化测试框架封装</p>
<ol>
<li>通过yaml组织用例</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test_name:百度接口测试</span><br><span class="line">steps:</span><br><span class="line">	- request</span><br><span class="line">		method: get</span><br><span class="line">		url: https://www.baidu.com</span><br><span class="line">		</span><br><span class="line">	-reponse</span><br><span class="line">		status_code: 200</span><br><span class="line">		text: &quot;baidu&quot;</span><br></pre></td></tr></table></figure>

<p>2、通过hook调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> requests <span class="comment"># 请求接口</span></span><br><span class="line"><span class="keyword">import</span> responses_validator <span class="comment"># 断言响应</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pytest_yaml_run_step</span>(<span class="params">item</span>):</span><br><span class="line">	step = item.current_step</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 接收yaml文件</span></span><br><span class="line">	key = <span class="built_in">list</span>(step)[<span class="number">0</span>]</span><br><span class="line">	value = <span class="built_in">list</span>(step.values())[<span class="number">0</span>]</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">match</span> key:</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;request&#x27;</span>:</span><br><span class="line">			item.resp = requests.request(**value)</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;response&#x27;</span>:</span><br><span class="line">			responses_validator.validator(item.resp, **value)</span><br><span class="line">		<span class="keyword">return</span> Ture</span><br></pre></td></tr></table></figure>

<h2 id="App自动化"><a href="#App自动化" class="headerlink" title="App自动化"></a>App自动化</h2><h3 id="Appnium"><a href="#Appnium" class="headerlink" title="Appnium"></a>Appnium</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><ul>
<li>自动化程序 调用客户端库相应的函数， 发送指令（封装在HTTP消息里）给 Appium Server</li>
<li>Appium Server 再转发这个指令给手机上的自动化代理</li>
<li>手机上的自动化代理接收到 指令后，调用手机平台的自动化库，执行点击操作，返回点击成功的结果给 Appium Server</li>
<li>Appium Server 转发给自动化程序</li>
<li>自动化程序了解到本操作成功后，继续后面的自动化流程</li>
</ul>
<blockquote>
<p>其中，自动化代理控制，使用的什么库来实现自动化的呢？</p>
<p>如果测试的是苹果手机， 用的是苹果的 XCUITest 框架 （IOS9.3版本以后）</p>
<p>如果测试的是安卓手机，用的是安卓的 UIAutomator 框架 (Android4.2以后)</p>
</blockquote>
<h4 id="自动化环境搭建"><a href="#自动化环境搭建" class="headerlink" title="自动化环境搭建"></a>自动化环境搭建</h4><ul>
<li>安装appmium库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install appium-python-client</span><br></pre></td></tr></table></figure>

<ul>
<li>安装Appium Server</li>
</ul>
<p> Appium Server 是用 nodejs 运行的，基于js开发出来的，Appium组织为了方便大家安装使用，制作了一个可执行程序 Appium Desktop，把 nodejs 运行环境、Appium Server 和一些工具 打包在里面了，只需要简单的下载安装就可以了。<a target="_blank" rel="noopener" href="https://github.com/appium/appium-desktop/releases/latest">Appium Desktop下载地址</a></p>
<ul>
<li><p>安装 jdk 添加环境变量</p>
</li>
<li><p>安装 Android SDK 添加一个 环境变量 <code>ANDROID_HOME</code>，设置值为sdk包解压目录；</p>
</li>
<li><p>推荐另外配置环境变量 PATH ，加入 adb所在目录，</p>
</li>
</ul>
<h4 id="连接手机"><a href="#连接手机" class="headerlink" title="连接手机"></a>连接手机</h4><p>打开开发者模式，开启USB调试。</p>
<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> appium.webdriver.extensions.android.nativekey <span class="keyword">import</span> AndroidKey</span><br><span class="line"><span class="keyword">from</span> appium.options.android <span class="keyword">import</span> UiAutomator2Options</span><br><span class="line"></span><br><span class="line">desired_caps = &#123;</span><br><span class="line">  <span class="string">&#x27;platformName&#x27;</span>: <span class="string">&#x27;Android&#x27;</span>, <span class="comment"># 被测手机是安卓</span></span><br><span class="line">  <span class="string">&#x27;platformVersion&#x27;</span>: <span class="string">&#x27;14&#x27;</span>, <span class="comment"># 手机安卓版本，如果是鸿蒙系统，依次尝试 12、11、10 这些版本号</span></span><br><span class="line">  <span class="string">&#x27;deviceName&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="comment"># 设备名，安卓手机可以随意填写</span></span><br><span class="line">  <span class="string">&#x27;appPackage&#x27;</span>: <span class="string">&#x27;tv.danmaku.bili&#x27;</span>, <span class="comment"># 启动APP Package名称</span></span><br><span class="line">  <span class="string">&#x27;appActivity&#x27;</span>: <span class="string">&#x27;.MainActivityV2&#x27;</span>, <span class="comment"># 启动Activity名称</span></span><br><span class="line">  <span class="string">&#x27;unicodeKeyboard&#x27;</span>: <span class="literal">True</span>, <span class="comment"># 自动化需要输入中文时填True</span></span><br><span class="line">  <span class="string">&#x27;resetKeyboard&#x27;</span>: <span class="literal">True</span>, <span class="comment"># 执行完程序恢复原来输入法</span></span><br><span class="line">  <span class="string">&#x27;noReset&#x27;</span>: <span class="literal">True</span>,       <span class="comment"># 不要重置App</span></span><br><span class="line">  <span class="string">&#x27;newCommandTimeout&#x27;</span>: <span class="number">6000</span>,</span><br><span class="line">  <span class="string">&#x27;automationName&#x27;</span> : <span class="string">&#x27;UiAutomator2&#x27;</span></span><br><span class="line">  <span class="comment"># &#x27;app&#x27;: r&#x27;d:\apk\bili.apk&#x27;,</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接Appium Server，初始化自动化环境</span></span><br><span class="line">driver = webdriver.Remote(<span class="string">&#x27;http://localhost:4723/wd/hub&#x27;</span>, </span><br><span class="line">  options=UiAutomator2Options().load_capabilities(desired_caps))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置缺省等待时间</span></span><br><span class="line">driver.implicitly_wait(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果有`青少年保护`界面，点击`我知道了`</span></span><br><span class="line">iknow = driver.find_elements(By.ID, <span class="string">&quot;text3&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> iknow:</span><br><span class="line">    iknow.click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据id定位搜索位置框，点击</span></span><br><span class="line">driver.find_element(By.ID, <span class="string">&#x27;expand_search&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据id定位搜索输入框，点击</span></span><br><span class="line">sbox = driver.find_element(By.ID, <span class="string">&#x27;search_src_text&#x27;</span>)</span><br><span class="line">sbox.send_keys(<span class="string">&#x27;白月黑羽&#x27;</span>)</span><br><span class="line"><span class="comment"># 输入回车键，确定搜索</span></span><br><span class="line">driver.press_keycode(AndroidKey.ENTER)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择（定位）所有视频标题</span></span><br><span class="line">eles = driver.find_elements(By.ID, <span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ele <span class="keyword">in</span> eles:</span><br><span class="line">    <span class="comment"># 打印标题</span></span><br><span class="line">    <span class="built_in">print</span>(ele.text)</span><br><span class="line"></span><br><span class="line"><span class="built_in">input</span>(<span class="string">&#x27;**** Press to quit..&#x27;</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h4 id="查找-应用-Package-和-Activity"><a href="#查找-应用-Package-和-Activity" class="headerlink" title="查找 应用 Package 和 Activity"></a>查找 应用 Package 和 Activity</h4><p>如果没有apk，打开进入应用界面执行，会显示最近的几个activity 信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys activity recents | find &quot;intent=&#123;&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>例如会打印：intent&#x3D;{act&#x3D;android.intent.action.MAIN cat&#x3D;[android.intent.category.LAUNCHER] flg&#x3D;0x10200000 cmp&#x3D;tv.danmaku.bili&#x2F;.MainActivityV2}</p>
<p>其中应用的package名称就是 <code>tv.danmaku.bili</code></p>
<p>应用的启动Activity就是 <code>.MainActivityV2</code></p>
</blockquote>
<p>如果有apk文件，执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d:\tools\androidsdk\build-tools\29.0.3\aapt.exe dump badging d:\tools\apk\bili.apk | find &quot;package: name=&quot;</span><br></pre></td></tr></table></figure>

<h4 id="定位元素"><a href="#定位元素" class="headerlink" title="定位元素"></a>定位元素</h4><p>Appium 要自动化手机应用，同样需要工具查看界面元素的特征。</p>
<p>常用的查看工具是： Android Sdk包中的 <code>uiautomateviewer</code> 和 Appium Desktop 中的 <code>Appium Inspector</code>。</p>
<blockquote>
<p>uiautomateviewer在SDK目录目录 的 tools\bin 目录中。</p>
</blockquote>
<h5 id="根据id"><a href="#根据id" class="headerlink" title="根据id"></a>根据id</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium.webdriver.common.appiumby <span class="keyword">import</span> AppiumBy</span><br><span class="line"></span><br><span class="line">driver.find_element(AppiumBy.ID, <span class="string">&#x27;expand_search&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="根据CLASS-NAME"><a href="#根据CLASS-NAME" class="headerlink" title="根据CLASS NAME"></a>根据CLASS NAME</h5><p>安卓界面元素的 class属性 其实就是根据元素的类型，类似web里面的tagname，一般我们根据class 属性来选择元素，是要选择多个而不是一个。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium.webdriver.common.appiumby <span class="keyword">import</span> AppiumBy</span><br><span class="line"></span><br><span class="line">driver.find_element(</span><br><span class="line">  AppiumBy.CLASS_NAME, </span><br><span class="line">  <span class="string">&#x27;android.widget.TextView&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="根据ACCESSIBILITY-ID"><a href="#根据ACCESSIBILITY-ID" class="headerlink" title="根据ACCESSIBILITY ID"></a>根据ACCESSIBILITY ID</h5><p>元素的 content-desc 属性是用来描述该元素的作用的。</p>
<p>如果要查询的界面元素有 content-desc属性，我们可以通过它来定位选择元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium.webdriver.common.appiumby <span class="keyword">import</span> AppiumBy</span><br><span class="line"></span><br><span class="line">driver.find_element(AppiumBy.ACCESSIBILITY_ID, <span class="string">&#x27;找人&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="Xpath"><a href="#Xpath" class="headerlink" title="Xpath"></a>Xpath</h5><p>可靠性和性能不如 Selenium Web自动化，因为Web自动化对Xpath的支持是由浏览器实现的，而Appium Xpath的支持是 Appium Server实现的。</p>
<p>毕竟，浏览器产品的成熟度比Appium要高很多。</p>
<p>语法都类似，但又一点，tagname-&gt;class属性值。</p>
<h4 id="安卓-UIAutomator"><a href="#安卓-UIAutomator" class="headerlink" title="安卓 UIAutomator"></a>安卓 UIAutomator</h4><p>以上这些方法选择元素，其实底层都是利用了安卓 uiautomator框架的API功能实现的。<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/testing/ui-automator">谷歌安卓官网</a></p>
<p>也就是说，程序的这些定位请求，被Appium server转发给手机自动化代理程序，就转化为为uiautomator里面相应的定位函数调用。</p>
<p>其实，我们的自动化程序，可以直接告诉手机上的自动化代理程序，让它调用UI Automator API的java代码，实现最为直接的自动化控制。</p>
<p>主要是通过 UiSelector 这个类里面的方法实现元素定位的，比如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium.webdriver.common.appiumby <span class="keyword">import</span> AppiumBy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code = <span class="string">&#x27;new UiSelector().text(&quot;热门&quot;).className(&quot;android.widget.TextView&quot;)&#x27;</span></span><br><span class="line">driver.find_element(AppiumBy.ANDROID_UIAUTOMATOR, code) <span class="comment"># 通过 text 属性 和 className的属性 两个条件 来定位元素</span></span><br><span class="line">ele.click()</span><br></pre></td></tr></table></figure>

<p>这样做的好处是：UiSelector里面有些元素选择的方法 可以解决 前面解决不了的问题。</p>
<blockquote>
<ul>
<li><code>text</code> 方法</li>
</ul>
<p>可以根据元素的文本属性查找元素</p>
<ul>
<li><code>textContains</code></li>
</ul>
<p>根据文本包含什么字符串</p>
<ul>
<li><code>textStartsWith</code></li>
</ul>
<p>根据文本以什么字符串开头</p>
<ul>
<li><code>textmartch</code> 方法</li>
</ul>
<p>可以使用正则表达式 选择一些元素，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code = &#x27;new UiSelector().textMatches(&quot;^我的.*&quot;)&#x27;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="界面操作和adb命令"><a href="#界面操作和adb命令" class="headerlink" title="界面操作和adb命令"></a>界面操作和adb命令</h4><h5 id="界面操作"><a href="#界面操作" class="headerlink" title="界面操作"></a>界面操作</h5><ul>
<li>click点击</li>
</ul>
<p>WebElement 对象的 <code>click</code> 方法</p>
<ul>
<li>tap点按</li>
</ul>
<p>tap和click的区别是， tap是 <strong>针对坐标</strong>而不是针对找到的元素，但是不同的手机有不同的分辨率，所以click是更好的使用方式。实在没有别的方法定位才使用tap。</p>
<p>inspect 查看该元素的属性中，有一个 <code>bounds</code> 属性，它就是表示元素的左上角，右下角坐标的坐标。还可以使用 UIAutomatorviewer 直接光标移动，看右边的属性提示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver.tap([(<span class="number">850</span>,<span class="number">1080</span>)],<span class="number">300</span>)</span><br><span class="line"><span class="comment"># 第一个参数是个列表，表示点击的坐标，注意最多可以有5个元素，代表5根手指点击5个坐标。所以是list类型。</span></span><br><span class="line"><span class="comment"># 第二个参数 表示 tap点按屏幕后 停留的时间。如果点按时间过长，就变成了长按操作了。</span></span><br></pre></td></tr></table></figure>

<ul>
<li>输入</li>
</ul>
<p>WebElement 对象的 <code>send_keys</code> 方法</p>
<ul>
<li>获取界面文本信息</li>
</ul>
<p> WebElement 对象的 <code>.text</code> 属性</p>
<ul>
<li>滑动</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver.swipe(start_x=x, start_y=y1, end_x=x, end_y=y2, duration=800)</span><br><span class="line"># 前面4个参数 是 滑动起点 和 终点 的x、y坐标。</span><br><span class="line"># 第5个参数 duration是滑动从起点到终点坐标所耗费的时间。注意这个滑动时间，如果太快，可能会有惯性滑动。</span><br></pre></td></tr></table></figure>

<ul>
<li>按键</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium.webdriver.extensions.android.nativekey <span class="keyword">import</span> AndroidKey</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入回车键，确定搜索</span></span><br><span class="line">driver.press_keycode(AndroidKey.ENTER)</span><br></pre></td></tr></table></figure>

<p>按键的定义，可以参考<a target="_blank" rel="noopener" href="https://github.com/appium/python-client/blob/master/appium/webdriver/extensions/android/nativekey.py">这篇文档</a></p>
<ul>
<li>长按、双击、移动</li>
</ul>
<p>Appium的 TouchAction 类提供了更多的手机操作方法，比如：长按、双击、移动。</p>
<p>参考源代码中的[注释](<a target="_blank" rel="noopener" href="https://github.com/appium/python-client/blob/master/appium/webdriver/common/touch_action.py">https://github.com/appium/python-client/blob/master/appium/webdriver/common/touch_action.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 长按</span></span><br><span class="line"><span class="keyword">from</span> appium.webdriver.common.touch_action <span class="keyword">import</span> TouchAction</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">actions = TouchAction(driver)</span><br><span class="line">actions.long_press(element)</span><br><span class="line">actions.perform()</span><br></pre></td></tr></table></figure>

<ul>
<li>查看通知栏</li>
</ul>
<p>一、通过滑动实现，</p>
<p>二、通过以下方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.open_notifications()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通知栏里面的元素，自动化的方法 和 前面介绍的App界面元素自动化是一样的。</p>
</blockquote>
<ul>
<li>收起通知栏</li>
</ul>
<p>收起通知栏，可以使用前面介绍的模拟按键， 发出返回按键的方法。</p>
<h4 id="adb-命令"><a href="#adb-命令" class="headerlink" title="adb 命令"></a>adb 命令</h4><p>adb工具在sdk中的platform-tools目录下。确保路径在path环境变量中。</p>
<p>既然这是个命令，就可以使用 Python的 <code>os.system()</code> 或者 <code>subprocess</code> 来自动化调用它。比如截屏：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&#x27;adb shell screencap /sdcard/screen3.png &amp;&amp; adb pull /sdcard/screen3.png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/tools/adb?hl=zh-cn#devicestatus">官网命令介绍</a></p>
<p><strong>常用命令</strong></p>
<ul>
<li>查看连接的设备</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices -l</span><br></pre></td></tr></table></figure>

<ul>
<li>列出文件和传输文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看目录</span><br><span class="line">adb shell ls /sdcard</span><br><span class="line"># 上传</span><br><span class="line">adb push wv.apk /sdcard/wv.apk</span><br><span class="line"># 下载</span><br><span class="line">adb pull /sdcard/new.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>登录shell执行各种linux命令</li>
</ul>
<p>ps、netstat、netstat -an|grep 4724、 pwd、 ls 、cd 、rm 等。</p>
<h4 id="内嵌网页自动化"><a href="#内嵌网页自动化" class="headerlink" title="内嵌网页自动化"></a>内嵌网页自动化</h4><p>很多移动App 都是 <code>Hybrid（混合）</code> 应用。混合应用主要是指它的一部分是原生界面和代码，而另一部分是内嵌网页 。App中的内嵌的展示网页内容的模块，我们称之为 <code>webview</code> 。比如微信打开某个朋友圈，或者别人发来的的链接。对其自动化则需要修改APP源代码。</p>
<h5 id="修改编译App"><a href="#修改编译App" class="headerlink" title="修改编译App"></a>修改编译App</h5><p>要对App内嵌网页进行自动化，首先要请开发人员修改源代码，保证对webview 对象加入setWebContentsDebuggingEnabled 的调用。编译出一个支持自动化的版本,否则无法对webview中的内容进行自动化操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">// 找到 webview 对象</span></span><br><span class="line">    <span class="type">WebView</span> <span class="variable">myWebView</span> <span class="operator">=</span> (WebView) findViewById(R.id.jcywebview);</span><br><span class="line">    <span class="comment">// 添加打开 webview内容debug开关</span></span><br><span class="line">    myWebView.setWebContentsDebuggingEnabled(<span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="用Chrome查看App内嵌网页"><a href="#用Chrome查看App内嵌网页" class="headerlink" title="用Chrome查看App内嵌网页"></a>用Chrome查看App内嵌网页</h5><p>产生了 支持自动化的App，接下来我们就可以安装到手机上，进行内嵌网页的自动化了。</p>
<p>但是，因为网页内容在手机中呈现，不能像电脑浏览器那样，打开开发者工具，查看元素内容。那如何来定位选择元素呢？这里要分两种情况：</p>
<ol>
<li><p>webview不依赖App环境</p>
<p>这种情况：App的<strong>内嵌 webview 和 native部分没有交互</strong>，直接用Chrome浏览器F12里面的手机模式打开对应的网页即可。（url一般是该公司的手机网址）</p>
</li>
<li><p>webview依赖App环境</p>
<p>这种情况：App的内嵌 webview 和 native部分有交互， 它必须在app中才能运行。可以通过Chrome浏览器 的远程调试功能，需要挂梯子。然后操作步骤如下：</p>
<p>1、确保我们的应用运行，</p>
<p>2、打开chrome浏览器，地址栏输入 <code>chrome://inspect</code> ，点击inspect即可查看。</p>
<p>具体参考<a target="_blank" rel="noopener" href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews">官网</a></p>
</li>
</ol>
<h5 id="自动化代码"><a href="#自动化代码" class="headerlink" title="自动化代码"></a>自动化代码</h5><p>手机App中 webview 里面的网页内容， 是在一个<strong>独立于</strong>应用native部分的环境里面的。而缺省情况下，find_element_by_xxx 这样的代码选择元素, Appium 只会在 native 部分的界面寻找元素。 肯定找不到元素。</p>
<p>Appium 把一个界面环境 称之为一个 <code>context</code> 。native 部分的 context 名字为 <code>NATIVE_APP</code> , 而webview部分的context则为 <code>WEBVIEW_XXX</code> （XXX部分是 应用的 app package名，可以通过<code>driver.contexts</code>属性获取当前所有的 context，用<code>current_context</code> 属性获取当前所在的 context。然后使用<code>switch_to.context</code>切换即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.context(&#x27;WEBVIEW_com.example.jcy.wvtest&#x27;)</span><br></pre></td></tr></table></figure>

<p>切换回来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to.context(&#x27;NATIVE_APP&#x27;)</span><br></pre></td></tr></table></figure>

<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>现在新版本的appium ，对webview这种类型的自动化，desired_caps需要加上<code>&#39;chromeOptions&#39;:&#123;&#39;w3c&#39;:False&#125;</code>,否则，可能出现webview里面find_element 选择元素，出现 <code>invalid locator</code> 的问题。</p>
<h5 id="手机浏览器网页自动化"><a href="#手机浏览器网页自动化" class="headerlink" title="手机浏览器网页自动化"></a>手机浏览器网页自动化</h5><p>有的公司开发了手机版网站，直接用手机浏览器打开的，并不是手机App，要实现自动化，首先，必须在手机上安装谷歌浏览器，然后，我们的自动化程序代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> appium.options.android <span class="keyword">import</span> UiAutomator2Options</span><br><span class="line"></span><br><span class="line">desired_caps = &#123;&#125;</span><br><span class="line">desired_caps[<span class="string">&#x27;platformName&#x27;</span>] = <span class="string">&#x27;Android&#x27;</span></span><br><span class="line">desired_caps[<span class="string">&#x27;platformVersion&#x27;</span>] = <span class="string">&#x27;14&#x27;</span></span><br><span class="line">desired_caps[<span class="string">&#x27;deviceName&#x27;</span>] = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">desired_caps[<span class="string">&#x27;browserName&#x27;</span>] = <span class="string">&#x27;Chrome&#x27;</span></span><br><span class="line">desired_caps[<span class="string">&#x27;newCommandTimeout&#x27;</span>] = <span class="number">6000</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Remote(<span class="string">&#x27;http://localhost:4723/wd/hub&#x27;</span>, </span><br><span class="line">  options=UiAutomator2Options().load_capabilities(desired_caps))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">    driver.get(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    driver.find_element(By.ID, <span class="string">&#x27;index-kw&#x27;</span>).send_keys(<span class="string">&#x27;白月黑羽&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    driver.find_element(By.ID, <span class="string">&#x27;index-bn&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(traceback.format_exc())</span><br></pre></td></tr></table></figure>

<h5 id="webview、驱动-版本配套"><a href="#webview、驱动-版本配套" class="headerlink" title="webview、驱动 版本配套"></a>webview、驱动 版本配套</h5><p>对于比较老的手机，手机里面的 webview 版本也会比较老，这是就会出现和新版本的appium desktop里面的 chromedriver 不匹配的问题，这时需要下载相应版本的chromedriver ，在appium desktop中进行设置。</p>
<p>路径：Advanced-Chromedriver Binary Path。</p>
<p>参考链接：</p>
<p>【1】<a target="_blank" rel="noopener" href="https://www.byhy.net/">https://www.byhy.net/</a></p>
<p>【2】<a target="_blank" rel="noopener" href="https://blog.csdn.net/amateurSU/article/details/136673353?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522105926cb47529f5403a759b1d346971f%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=105926cb47529f5403a759b1d346971f&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-136673353-null-null.142%5Ev101%5Epc_search_result_base7&utm_term=@classmethod&spm=1018.2226.3001.4187">https://blog.csdn.net/amateurSU/article/details/136673353?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522105926cb47529f5403a759b1d346971f%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=105926cb47529f5403a759b1d346971f&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-136673353-null-null.142^v101^pc_search_result_base7&amp;utm_term=%40classmethod&amp;spm=1018.2226.3001.4187</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Cris Kou</div><div class="post-copyright__author_desc">千里之行，始于足下</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/')">自动化测试</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=自动化测试&amp;url=http://example.com/2025/02/16/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Cris Kou的成长日记</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>自动化测试<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/02/15/JMeter-%E5%B7%A5%E5%85%B7/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JMeter[工具]</div></div></a></div><div class="next-post pull-right"><a href="/2025/02/16/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">读书笔记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zc998800/cdn/face/gif/p113.gif" alt="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">自动化测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB-UI%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">WEB UI自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Selenium"><span class="toc-number">1.1.1.</span> <span class="toc-text">Selenium</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">常见问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">选择元素</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.1.</span> <span class="toc-text">根据id属性定位元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEclass%E5%B1%9E%E6%80%A7%E9%80%89%E6%8B%A9%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.2.</span> <span class="toc-text">根据class属性选择元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEtag%E5%90%8D%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.3.</span> <span class="toc-text">根据tag名定位元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87WebElement%E5%AF%B9%E8%B1%A1%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.4.</span> <span class="toc-text">通过WebElement对象定位元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E6%8E%A7%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.5.</span> <span class="toc-text">操控元素</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CSS%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.1.1.5.6.</span> <span class="toc-text">CSS表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE-tag%E5%90%8D%E3%80%81id%E3%80%81class-%E9%80%89%E6%8B%A9%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.6.1.</span> <span class="toc-text">根据 tag名、id、class 选择元素</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%AD%90%E5%85%83%E7%B4%A0%E5%92%8C%E5%90%8E%E4%BB%A3%E5%85%83%E7%B4%A0"><span class="toc-number">1.1.1.5.6.2.</span> <span class="toc-text">选择子元素和后代元素</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%B1%9E%E6%80%A7%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.6.3.</span> <span class="toc-text">根据属性选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%81%94%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.1.5.6.4.</span> <span class="toc-text">联合使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%84%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.6.5.</span> <span class="toc-text">组选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8C%89%E6%AC%A1%E5%BA%8F%E9%80%89%E6%8B%A9%E5%AD%90%E8%8A%82%E7%82%B9"><span class="toc-number">1.1.1.5.6.6.</span> <span class="toc-text">按次序选择子节点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%84%E5%BC%9F%E8%8A%82%E7%82%B9%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.6.7.</span> <span class="toc-text">兄弟节点选择</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XPath%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">1.1.1.5.7.</span> <span class="toc-text">XPath选择器</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.7.1.</span> <span class="toc-text">绝对路径选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.7.2.</span> <span class="toc-text">相对路径选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">1.1.1.5.7.3.</span> <span class="toc-text">通配符</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%B1%9E%E6%80%A7%E9%80%89%E6%8B%A9-1"><span class="toc-number">1.1.1.5.7.4.</span> <span class="toc-text">根据属性选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8C%89%E6%AC%A1%E5%BA%8F%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.7.5.</span> <span class="toc-text">按次序选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.5.7.6.</span> <span class="toc-text">范围选择</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%84%E9%80%89%E6%8B%A9%E3%80%81%E7%88%B6%E8%8A%82%E7%82%B9%E3%80%81%E5%85%84%E5%BC%9F%E8%8A%82%E7%82%B9"><span class="toc-number">1.1.1.5.7.7.</span> <span class="toc-text">组选择、父节点、兄弟节点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#frame%E5%88%87%E6%8D%A2-%E7%AA%97%E5%8F%A3%E5%88%87%E6%8D%A2"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">frame切换&#x2F;窗口切换</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#frame-iframe"><span class="toc-number">1.1.1.6.1.</span> <span class="toc-text">frame&#x2F;iframe</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%88%87%E6%8D%A2"><span class="toc-number">1.1.1.6.2.</span> <span class="toc-text">窗口切换</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%A1%86"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">选择框</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#radio"><span class="toc-number">1.1.1.7.1.</span> <span class="toc-text">radio</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#checkbox"><span class="toc-number">1.1.1.7.2.</span> <span class="toc-text">checkbox</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#select"><span class="toc-number">1.1.1.7.3.</span> <span class="toc-text">select</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.1.8.1.</span> <span class="toc-text">等待方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E5%8A%A8%E4%BD%9C"><span class="toc-number">1.1.1.8.2.</span> <span class="toc-text">更多动作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8Cjavascript"><span class="toc-number">1.1.1.8.3.</span> <span class="toc-text">直接执行javascript</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%BB%E7%BB%93%E7%95%8C%E9%9D%A2"><span class="toc-number">1.1.1.8.4.</span> <span class="toc-text">冻结界面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">1.1.1.8.5.</span> <span class="toc-text">弹出对话框</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.1.1.8.6.</span> <span class="toc-text">窗口大小</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%AA%97%E5%8F%A3%E6%A0%87%E9%A2%98"><span class="toc-number">1.1.1.8.7.</span> <span class="toc-text">获取当前窗口标题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%AA%97%E5%8F%A3URL%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.1.8.8.</span> <span class="toc-text">获取当前窗口URL地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%AA%E5%B1%8F"><span class="toc-number">1.1.1.8.9.</span> <span class="toc-text">截屏</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.1.8.10.</span> <span class="toc-text">手机模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.1.8.11.</span> <span class="toc-text">上传文件</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">1.2.</span> <span class="toc-text">API接口自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">HTTP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF"><span class="toc-number">1.2.2.</span> <span class="toc-text">HTTP请求消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%A1%8C-request-line"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">请求行 request line</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4-request-headers"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">请求头 request headers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BD%93-message-body"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">消息体 message body</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%93%8D%E5%BA%94%E6%B6%88%E6%81%AF"><span class="toc-number">1.2.3.</span> <span class="toc-text">HTTP响应消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E8%A1%8C-status-line"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">状态行 status line</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%B4-response-headers"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">响应头 response headers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BD%93-message-body-1"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">消息体 message body</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.4.</span> <span class="toc-text">接口测试概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Requests%E5%BA%93"><span class="toc-number">1.2.5.</span> <span class="toc-text">Requests库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#requests%E7%A8%8B%E5%BA%8F%E6%8A%93%E5%8C%85%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E4%B8%BAFiddler"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">requests程序抓包设置代理为Fiddler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0-params"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">构建请求参数 params</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF%E5%A4%B4-headers"><span class="toc-number">1.2.5.4.</span> <span class="toc-text">构建请求消息头 headers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF%E4%BD%93-data"><span class="toc-number">1.2.5.5.</span> <span class="toc-text">构建请求消息体 data</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XML%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.5.5.1.</span> <span class="toc-text">XML格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#urlencoded-%E6%A0%BC%E5%BC%8F%E6%B6%88%E6%81%AF%E4%BD%93"><span class="toc-number">1.2.5.5.2.</span> <span class="toc-text">urlencoded 格式消息体</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JSON-%E6%A0%BC%E5%BC%8F%E6%B6%88%E6%81%AF%E4%BD%93"><span class="toc-number">1.2.5.5.3.</span> <span class="toc-text">JSON 格式消息体</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">1.2.5.6.</span> <span class="toc-text">检查响应状态码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%93%8D%E5%BA%94%E6%B6%88%E6%81%AF%E5%A4%B4"><span class="toc-number">1.2.5.7.</span> <span class="toc-text">检查响应消息头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%93%8D%E5%BA%94%E6%B6%88%E6%81%AF%E4%BD%93"><span class="toc-number">1.2.5.8.</span> <span class="toc-text">检查响应消息体</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Session"><span class="toc-number">1.2.6.</span> <span class="toc-text">Session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#requests%E5%A4%84%E7%90%86session-Cookie"><span class="toc-number">1.2.7.</span> <span class="toc-text">requests处理session-Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Session%E5%AF%B9%E8%B1%A1%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="toc-number">1.2.8.</span> <span class="toc-text">Session对象使用代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">1.2.9.</span> <span class="toc-text">接口测试数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85API%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">1.2.10.</span> <span class="toc-text">封装API测试类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.11.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6Pytetst"><span class="toc-number">1.3.</span> <span class="toc-text">自动化测试框架Pytetst</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">快速上手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B8%85%E9%99%A4"><span class="toc-number">1.3.4.</span> <span class="toc-text">初始化清除</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E7%BA%A7%E5%88%AB"><span class="toc-number">1.3.4.0.1.</span> <span class="toc-text">模块级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.3.4.0.2.</span> <span class="toc-text">类级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E7%BA%A7%E5%88%AB"><span class="toc-number">1.3.4.0.3.</span> <span class="toc-text">方法级别</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BA%A7%E5%88%AB"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">目录级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%91%E9%80%89%E7%94%A8%E4%BE%8B%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.5.</span> <span class="toc-text">挑选用例执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">指定一个模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E6%88%96%E5%A4%9A%E4%B8%AA%E7%9B%AE%E5%BD%95"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">指定一个或多个目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%A8%A1%E5%9D%97%E9%87%8C%E9%9D%A2%E7%9A%84%E5%87%BD%E6%95%B0%E6%88%96%E8%80%85%E7%B1%BB"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">指定模块里面的函数或者类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%90%8D%E5%AD%97"><span class="toc-number">1.3.5.4.</span> <span class="toc-text">根据名字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%A0%87%E7%AD%BE"><span class="toc-number">1.3.5.5.</span> <span class="toc-text">根据标签</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.3.6.</span> <span class="toc-text">数据驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fixture"><span class="toc-number">1.3.7.</span> <span class="toc-text">fixture</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.3.7.1.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fixture%E6%9C%AC%E8%BA%AB%E9%9C%80%E8%A6%81%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.7.2.</span> <span class="toc-text">fixture本身需要参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fixture%E8%8C%83%E5%9B%B4"><span class="toc-number">1.3.7.3.</span> <span class="toc-text">fixture范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#conftest-py"><span class="toc-number">1.3.7.4.</span> <span class="toc-text">conftest.py</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mark"><span class="toc-number">1.3.8.</span> <span class="toc-text">mark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hook"><span class="toc-number">1.3.9.</span> <span class="toc-text">hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%B0%81%E8%A3%85"><span class="toc-number">1.3.10.</span> <span class="toc-text">框架封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">1.3.10.1.</span> <span class="toc-text">日志记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A"><span class="toc-number">1.3.10.2.</span> <span class="toc-text">生成测试报告</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E9%94%AE%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="toc-number">1.3.10.3.</span> <span class="toc-text">一键执行脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E4%B8%9A%E5%8A%A1%E8%A1%A5%E5%85%85%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.10.4.</span> <span class="toc-text">根据业务补充代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#App%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">App自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Appnium"><span class="toc-number">1.4.1.</span> <span class="toc-text">Appnium</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">自动化环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%89%8B%E6%9C%BA"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">连接手机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE-%E5%BA%94%E7%94%A8-Package-%E5%92%8C-Activity"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">查找 应用 Package 和 Activity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0"><span class="toc-number">1.4.1.6.</span> <span class="toc-text">定位元素</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEid"><span class="toc-number">1.4.1.6.1.</span> <span class="toc-text">根据id</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AECLASS-NAME"><span class="toc-number">1.4.1.6.2.</span> <span class="toc-text">根据CLASS NAME</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEACCESSIBILITY-ID"><span class="toc-number">1.4.1.6.3.</span> <span class="toc-text">根据ACCESSIBILITY ID</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Xpath"><span class="toc-number">1.4.1.6.4.</span> <span class="toc-text">Xpath</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%8D%93-UIAutomator"><span class="toc-number">1.4.1.7.</span> <span class="toc-text">安卓 UIAutomator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C%E5%92%8Cadb%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.1.8.</span> <span class="toc-text">界面操作和adb命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.8.1.</span> <span class="toc-text">界面操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#adb-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.1.9.</span> <span class="toc-text">adb 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%B5%8C%E7%BD%91%E9%A1%B5%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">1.4.1.10.</span> <span class="toc-text">内嵌网页自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BC%96%E8%AF%91App"><span class="toc-number">1.4.1.10.1.</span> <span class="toc-text">修改编译App</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8Chrome%E6%9F%A5%E7%9C%8BApp%E5%86%85%E5%B5%8C%E7%BD%91%E9%A1%B5"><span class="toc-number">1.4.1.10.2.</span> <span class="toc-text">用Chrome查看App内嵌网页</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.1.10.3.</span> <span class="toc-text">自动化代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">1.4.1.10.4.</span> <span class="toc-text">注意</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BD%91%E9%A1%B5%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">1.4.1.10.5.</span> <span class="toc-text">手机浏览器网页自动化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webview%E3%80%81%E9%A9%B1%E5%8A%A8-%E7%89%88%E6%9C%AC%E9%85%8D%E5%A5%97"><span class="toc-number">1.4.1.10.6.</span> <span class="toc-text">webview、驱动 版本配套</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/20/leetcode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" title="leetcode刷题笔记">leetcode刷题笔记</a><time datetime="2025-02-20T01:11:08.000Z" title="发表于 2025-02-20 09:11:08">2025-02-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/18/allure-%E5%B7%A5%E5%85%B7/" title="allure[工具]">allure[工具]</a><time datetime="2025-02-18T00:40:25.000Z" title="发表于 2025-02-18 08:40:25">2025-02-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/17/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%882%EF%BC%89/" title="读书笔记（2）">读书笔记（2）</a><time datetime="2025-02-17T09:29:29.000Z" title="发表于 2025-02-17 17:29:29">2025-02-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/17/Linux%E8%BF%90%E7%BB%B4/" title="Linux运维">Linux运维</a><time datetime="2025-02-17T01:35:17.000Z" title="发表于 2025-02-17 09:35:17">2025-02-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/16/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" title="读书笔记">读书笔记</a><time datetime="2025-02-16T06:26:25.000Z" title="发表于 2025-02-16 14:26:25">2025-02-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="Cris Kou" target="_blank">Cris Kou</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>1</sup></a><a href="/tags/Python%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Python基础<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 0.88rem;">学习笔记<sup>1</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">测试工具<sup>4</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">自动化测试<sup>1</sup></a><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 0.88rem;">读书笔记<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Cris Kou 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>